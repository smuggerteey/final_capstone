<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Creative Hub 🎨 - Unleash Your Creativity</title>
    <meta name="description" content="A gamified creative platform for drawing, recording, and writing with rewards">
    
    <!-- Favicon -->
    <link href="{{ url_for('static', filename='img/favicon.ico') }}" rel="icon">

    <!-- Google Web Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@400;500;600&family=Nunito:wght@600;700;800&family=Poppins:wght@300;400;500;600;700&family=Montserrat:wght@800;900&display=swap" rel="stylesheet">

    <!-- Icon Font Stylesheet -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">

    <!-- Libraries Stylesheet -->
    <link href="{{ url_for('static', filename='lib/animate/animate.min.css') }}" rel="stylesheet">
    <link href="{{ url_for('static', filename='lib/owlcarousel/assets/owl.carousel.min.css') }}" rel="stylesheet">

    <!-- Customized Bootstrap Stylesheet -->
    <link href="{{ url_for('static', filename='css/bootstrap.min.css') }}" rel="stylesheet">

    <!-- Template Stylesheet -->
    <link href="{{ url_for('static', filename='css/style.css') }}" rel="stylesheet">

    <!-- External Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.6.0/p5.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.1/fabric.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/confetti-js@0.0.18/dist/index.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/typed.js@2.0.12"></script>
    <script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>
    
    <!-- Custom CSS with Enhanced Features -->
    <style>
        :root {
            --primary-color: #06BBCC;
            --secondary-color: #3949ab;
            --accent-color: #ff7043;
            --dark-color: #1a237e;
            --light-color: #f5f5f5;
            --success-color: #43a047;
            --warning-color: #ffb300;
            --danger-color: #e53935;
            --info-color: #039be5;
            --text-color: #263238;
            --text-light: #546e7a;
            --bg-gradient: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
        }
        
        /* General Styles */
        body {
            font-family: 'Heebo', sans-serif;
            color: var(--text-color);
            background-color: var(--light-color);
            overflow-x: hidden;
            scroll-behavior: smooth;
            line-height: 1.6;
        }
        
        h1, h2, h3, h4, h5, h6 {
            font-family: 'Nunito', sans-serif;
            font-weight: 700;
            color: var(--dark-color);
        }
        
        .section-title {
            position: relative;
            display: inline-block;
            margin-bottom: 1.5rem;
            padding-bottom: 0.5rem;
        }
        
        .section-title::after {
            content: "";
            position: absolute;
            bottom: 0;
            left: 0;
            width: 50px;
            height: 4px;
            background: var(--bg-gradient);
            border-radius: 2px;
        }
        
        /* Layout Improvements */
        .main-container {
            display: grid;
            grid-template-columns: 280px 1fr;
            gap: 2rem;
        }
        
        @media (max-width: 992px) {
            .main-container {
                grid-template-columns: 1fr;
            }
        }
        
        /* Sidebar */
        .sidebar {
            position: sticky;
            top: 1rem;
            height: calc(100vh - 2rem);
            overflow-y: auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            padding: 1.5rem;
        }
        
        /* Navbar Styles */
        .navbar {
            box-shadow: 0 2px 15px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            background: white;
        }
        
        .navbar.scrolled {
            background-color: rgba(255, 255, 255, 0.98) !important;
            backdrop-filter: blur(10px);
            box-shadow: 0 2px 20px rgba(0, 0, 0, 0.15);
        }
        
        .navbar-light .navbar-nav .nav-link {
            padding: 10px 15px;
            color: var(--text-color);
            font-weight: 500;
            transition: all 0.3s;
            position: relative;
            border-radius: 6px;
        }
        
        .navbar-light .navbar-nav .nav-link:hover,
        .navbar-light .navbar-nav .nav-link.active {
            color: white;
            background: var(--bg-gradient);
        }
        
        .navbar-brand {
            font-weight: 800;
            letter-spacing: 0.5px;
            display: flex;
            align-items: center;
        }
        
        .navbar-brand i {
            margin-right: 0.5rem;
        }
        
        /* Hero Section */
        .hero-section {
            background: #7493bb;
            background-position: center;
            background-repeat: no-repeat;
            background-size: cover;
            padding: 120px 0;
            color: white;
            position: relative;
            overflow: hidden;
            min-height: 80vh;
            display: flex;
            align-items: center;
            text-align: center;
        }
        
        #particles-js {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: 0;
        }
        
        .hero-content {
            position: relative;
            z-index: 1;
            max-width: 800px;
            margin: 0 auto;
            padding: 0 1rem;
        }
        
        .hero-title {
            font-size: 3.5rem;
            font-weight: 800;
            margin-bottom: 1.5rem;
            line-height: 1.2;
            text-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }
        
        .hero-subtitle {
            font-size: 1.3rem;
            margin-bottom: 2rem;
            opacity: 0.9;
            text-shadow: 0 1px 5px rgba(0,0,0,0.3);
        }
        
        /* Dashboard Cards */
        .dashboard-card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
            margin-bottom: 1.5rem;
            transition: all 0.3s ease;
            border: none;
            overflow: hidden;
            position: relative;
        }
        
        .dashboard-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: var(--bg-gradient);
        }
        
        .dashboard-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.15);
        }
        
        .card-title {
            color: var(--primary-color);
            margin-bottom: 1rem;
            font-weight: 700;
            display: flex;
            align-items: center;
        }
        
        .card-title i {
            margin-right: 0.5rem;
        }
        
        /* Points Display */
        .points-display {
            background: var(--bg-gradient);
            color: white;
            padding: 1rem 2rem;
            border-radius: 50px;
            display: inline-flex;
            align-items: center;
            font-weight: bold;
            box-shadow: 0 10px 20px rgba(94, 53, 177, 0.3);
            margin-bottom: 1.5rem;
            border: 2px solid rgba(255,255,255,0.3);
            position: relative;
            overflow: hidden;
            font-size: 1.1rem;
        }
        
        .points-display::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(
                to bottom right,
                rgba(255,255,255,0) 0%,
                rgba(255,255,255,0.3) 50%,
                rgba(255,255,255,0) 100%
            );
            transform: rotate(30deg);
            animation: shine 3s infinite;
        }
        
        /* Progress Bar */
        .progress-container {
            height: 12px;
            background: #e9ecef;
            border-radius: 6px;
            overflow: hidden;
            max-width: 400px;
            margin: 0 auto;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);
            position: relative;
        }
        
        .progress-bar {
            height: 100%;
            transition: width 0.5s ease;
            position: relative;
            border-radius: 6px;
            background: var(--bg-gradient);
        }
        
        /* Streak Counter */
        .streak-counter {
            background: linear-gradient(135deg, var(--accent-color) 0%, #ffab91 100%);
            padding: 0.75rem 1.5rem;
            border-radius: 50px;
            color: white;
            font-weight: bold;
            box-shadow: 0 10px 20px rgba(255, 112, 67, 0.3);
            display: inline-flex;
            align-items: center;
            margin-bottom: 1.5rem;
            border: 2px solid rgba(255,255,255,0.3);
            font-size: 1.1rem;
        }
        
        .streak-counter i {
            margin-right: 0.5rem;
            font-size: 1.3rem;
        }
        
        /* Badges */
        .badge-container {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 1rem;
        }
        
        .badge-item {
            background: linear-gradient(135deg, #f0f1ff 0%, #e0e1ff 100%);
            color: var(--primary-color);
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.85rem;
            display: flex;
            align-items: center;
            transition: all 0.3s ease;
            box-shadow: 0 3px 8px rgba(94, 53, 177, 0.1);
            border: 1px solid rgba(94, 53, 177, 0.2);
        }
        
        .badge-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 15px rgba(94, 53, 177, 0.2);
        }
        
        .badge-item i {
            margin-right: 0.5rem;
            font-size: 0.9rem;
        }
        
        .badge-item.gold {
            background: linear-gradient(135deg, #FFD700 0%, #FFEC8B 100%);
            color: #5E3A1A;
            border-color: rgba(255, 215, 0, 0.3);
        }
        
        .badge-item.silver {
            background: linear-gradient(135deg, #C0C0C0 0%, #E6E6E6 100%);
            color: #424242;
            border-color: rgba(192, 192, 192, 0.3);
        }
        
        .badge-item.bronze {
            background: linear-gradient(135deg, #CD7F32 0%, #E6B17E 100%);
            color: #3E2723;
            border-color: rgba(205, 127, 50, 0.3);
        }
        
        /* Leaderboard */
        .leaderboard-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0 0.5rem;
        }
        
        .leaderboard-table th {
            background: var(--bg-gradient);
            color: white;
            padding: 1rem;
            text-align: left;
            position: sticky;
            top: 0;
            font-weight: 600;
        }
        
        .leaderboard-table td {
            padding: 1rem;
            background: white;
            transition: all 0.3s ease;
            font-weight: 500;
        }
        
        .leaderboard-table tr:hover td {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .leaderboard-table tr.rank-1 td {
            border-left: 4px solid gold;
            background-color: rgba(255, 215, 0, 0.05);
        }
        
        .leaderboard-table tr.rank-2 td {
            border-left: 4px solid silver;
            background-color: rgba(192, 192, 192, 0.05);
        }
        
        .leaderboard-table tr.rank-3 td {
            border-left: 4px solid #cd7f32;
            background-color: rgba(205, 127, 50, 0.05);
        }
        
        .rank-icon {
            color: var(--secondary-color);
            font-size: 1.3rem;
        }
        
        /* Content Sections */
        .content-section {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
            margin-bottom: 1.5rem;
            transition: all 0.3s ease;
            border: none;
            position: relative;
            overflow: hidden;
        }
        
        .content-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: var(--bg-gradient);
        }
        
        /* Drawing Canvas */
        #drawingCanvas {
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            margin-bottom: 1.5rem;
            display: block;
            background: white;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            transition: all 0.3s ease;
            cursor: crosshair;
            width: 100%;
            height: 500px;
        }
        
        /* Tool Buttons */
        .btn-tool {
            background: linear-gradient(135deg, #f0f1ff 0%, #e0e1ff 100%);
            border: none;
            color: var(--primary-color);
            padding: 0.75rem 1rem;
            border-radius: 8px;
            margin-right: 0.5rem;
            margin-bottom: 0.5rem;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 3px 8px rgba(94, 53, 177, 0.1);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-weight: 500;
            font-size: 0.9rem;
        }
        
        .btn-tool:hover {
            background: var(--bg-gradient);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(94, 53, 177, 0.2);
        }
        
        .btn-tool.active {
            background: var(--bg-gradient);
            color: white;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .btn-tool i {
            margin-right: 0.5rem;
        }
        
        /* Tool Groups */
        .tool-group {
            display: flex;
            flex-wrap: wrap;
            margin-bottom: 1rem;
        }
        
        /* Notepad */
        #notepadText {
            width: 100%;
            height: 300px;
            padding: 1rem;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            resize: none;
            font-family: inherit;
            transition: all 0.3s ease;
            background: linear-gradient(180deg, #f8f9fa 0%, white 100%);
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.05);
            font-size: 1rem;
            line-height: 1.6;
        }
        
        #notepadText:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 0.2rem rgba(94, 53, 177, 0.25);
            background: white;
            outline: none;
        }
        
        /* Challenges Table */
        .challenges-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0 0.5rem;
        }
        
        .challenges-table th {
            background: var(--bg-gradient);
            color: white;
            padding: 1rem;
            text-align: left;
            font-weight: 600;
        }
        
        .challenges-table td {
            padding: 1rem;
            background: white;
            transition: all 0.3s ease;
            font-weight: 500;
        }
        
        .challenges-table tr:hover td {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        /* Footer */
        .footer {
            background: var(--dark-color);
            color: white;
            position: relative;
            overflow: hidden;
            padding-top: 5rem;
        }
        
        .footer::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('data:image/svg+xml;utf8,<svg viewBox="0 0 1200 120" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="none"><path d="M0,0V46.29c47.79,22.2,103.59,32.17,158,28,70.36-5.37,136.33-33.31,206.8-37.5C438.64,32.43,512.34,53.67,583,72.05c69.27,18,138.3,24.88,209.4,13.08,36.15-6,69.85-17.84,104.45-29.34C989.49,25,1113-14.29,1200,52.47V0Z" opacity=".25" fill="%235e35b1"/><path d="M0,0V15.81C13,36.92,27.64,56.86,47.69,72.05,99.41,111.27,165,111,224.58,91.58c31.15-10.15,60.09-26.07,89.67-39.8,40.92-19,84.73-46,130.83-49.67,36.26-2.85,70.9,9.42,98.6,31.56,31.77,25.39,62.32,62,103.63,73,40.44,10.79,81.35-6.69,119.13-24.28s75.16-39,116.92-43.05c59.73-5.85,113.28,22.88,168.9,38.84,30.2,8.66,59,6.17,87.09-7.5,22.43-10.89,48-26.93,60.65-49.24V0Z" opacity=".5" fill="%235e35b1"/><path d="M0,0V5.63C149.93,59,314.09,71.32,475.83,42.57c43-7.64,84.23-20.12,127.61-26.46,59-8.63,112.48,12.24,165.56,35.4C827.93,77.22,886,95.24,951.2,90c86.53-7,172.46-45.71,248.8-84.81V0Z" fill="%235e35b1"/></svg>');
            background-size: cover;
            opacity: 0.1;
            z-index: 0;
        }
        
        .footer a {
            color: #e0e0e0;
            text-decoration: none;
            transition: all 0.3s;
            position: relative;
            z-index: 1;
        }
        
        .footer a:hover {
            color: white;
            text-decoration: underline;
        }
        
        .footer .btn-social {
            width: 40px;
            height: 40px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            margin-right: 0.5rem;
            transition: all 0.3s ease;
            background: rgba(255,255,255,0.1);
            color: white;
            position: relative;
            z-index: 1;
        }
        
        .footer .btn-social:hover {
            transform: translateY(-3px);
            background: var(--accent-color);
        }
        
        /* Animations */
        .floating {
            animation: floating 3s ease-in-out infinite;
        }
        
        @keyframes floating {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }
        
        @keyframes shine {
            0% { transform: translateX(-100%) rotate(30deg); }
            100% { transform: translateX(100%) rotate(30deg); }
        }
        
        /* Drawing Game Styles */
        .game-container {
            position: relative;
            overflow: hidden;
            border-radius: 12px;
            box-shadow: 0 15px 30px rgba(0,0,0,0.1);
            margin-bottom: 1.5rem;
        }
        
        .game-timer {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 50px;
            font-weight: bold;
            z-index: 10;
            display: flex;
            align-items: center;
            backdrop-filter: blur(5px);
            font-size: 1rem;
        }
        
        .timer-bar {
            width: 100px;
            height: 6px;
            background: rgba(255,255,255,0.3);
            border-radius: 3px;
            margin-left: 0.5rem;
            overflow: hidden;
        }
        
        .timer-progress {
            height: 100%;
            background: linear-gradient(90deg, #ff6584, #fbbf24);
            transition: width 0.5s linear;
            border-radius: 3px;
        }
        
        .accuracy-display {
            position: absolute;
            bottom: 1rem;
            right: 1rem;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 50px;
            font-weight: bold;
            z-index: 10;
            display: flex;
            align-items: center;
            backdrop-filter: blur(5px);
            font-size: 1rem;
        }
        
        .accuracy-bar {
            width: 100px;
            height: 6px;
            background: rgba(255,255,255,0.3);
            border-radius: 3px;
            margin-left: 0.5rem;
            overflow: hidden;
        }
        
        .accuracy-progress {
            height: 100%;
            background: linear-gradient(90deg, #42b0ff, var(--primary-color));
            transition: width 0.5s ease;
            border-radius: 3px;
        }
        
        .difficulty-selector {
            margin-bottom: 1.5rem;
        }
        
        .difficulty-btn {
            margin-right: 0.5rem;
            margin-bottom: 0.5rem;
            transition: all 0.3s ease;
            border-radius: 20px;
            font-weight: 500;
            padding: 0.5rem 1rem;
        }
        
        .game-instructions {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 1.5rem;
            border-radius: 12px;
            margin-bottom: 1.5rem;
            border-left: 4px solid var(--primary-color);
            transition: all 0.3s ease;
            box-shadow: 0 3px 10px rgba(0,0,0,0.05);
        }
        
        /* Game Controls */
        .game-controls {
            display: flex;
            justify-content: space-between;
            margin-top: 1.5rem;
            flex-wrap: wrap;
            gap: 0.5rem;
        }
        
        /* Target Object Preview */
        .target-preview {
            width: 150px;
            height: 150px;
            border: 2px dashed var(--primary-color);
            border-radius: 12px;
            margin: 1.5rem auto;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: rgba(94, 53, 177, 0.1);
            transition: all 0.3s ease;
            box-shadow: 0 3px 10px rgba(94, 53, 177, 0.1);
        }
        
        /* Game Results Modal */
        .game-results {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            max-width: 500px;
            margin: 0 auto;
            text-align: center;
            box-shadow: 0 15px 40px rgba(0,0,0,0.1);
        }
        
        .result-stars {
            font-size: 3rem;
            color: gold;
            margin: 1.5rem 0;
            text-shadow: 0 3px 10px rgba(255,215,0,0.3);
            letter-spacing: 5px;
        }
        
        .result-points {
            font-size: 2rem;
            color: var(--primary-color);
            font-weight: bold;
            margin: 1.5rem 0;
            background: var(--bg-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .result-breakdown {
            text-align: left;
            margin: 1.5rem 0;
            padding: 1.5rem;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 4px solid var(--primary-color);
        }
        
        /* AI Suggestions */
        .ai-suggestions {
            display: flex;
            gap: 0.5rem;
            justify-content: center;
            margin-top: 1.5rem;
            flex-wrap: wrap;
        }
        
        /* Streak Bonus Animation */
        .streak-bonus {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            background: linear-gradient(135deg, var(--accent-color) 0%, #ffab91 100%);
            padding: 1.5rem;
            border-radius: 12px;
            color: white;
            font-weight: bold;
            box-shadow: 0 10px 30px rgba(255, 112, 67, 0.4);
            z-index: 1000;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-width: 200px;
        }
        
        .streak-fire {
            font-size: 1.8rem;
            margin-bottom: 0.5rem;
        }
        
        .streak-points {
            font-size: 1.3rem;
            opacity: 0.9;
        }
        
        /* Skill Bars */
        .skill-bar {
            margin-bottom: 1.5rem;
        }
        
        .skill-bar span {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--text-color);
        }
        
        .bar-container {
            height: 10px;
            background: #e9ecef;
            border-radius: 5px;
            overflow: hidden;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .bar {
            height: 100%;
            background: var(--bg-gradient);
            border-radius: 5px;
            position: relative;
        }
        
        /* Confetti canvas */
        #confetti-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1000;
            pointer-events: none;
        }
        
        /* Pulse animation */
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }
        
        /* Gradient Text */
        .gradient-text {
            background: var(--bg-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            display: inline-block;
        }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--bg-gradient);
            border-radius: 10px;
        }
        
        /* Tab Styles */
        .nav-tabs {
            border-bottom: 2px solid #e0e0e0;
            margin-bottom: 1.5rem;
        }
        
        .nav-tabs .nav-link {
            border: none;
            color: var(--text-light);
            font-weight: 600;
            padding: 0.75rem 1.5rem;
            border-radius: 8px 8px 0 0;
            margin-right: 0.25rem;
            transition: all 0.3s;
        }
        
        .nav-tabs .nav-link:hover {
            border-color: transparent;
            color: var(--primary-color);
            background-color: rgba(94, 53, 177, 0.1);
        }
        
        .nav-tabs .nav-link.active {
            color: var(--primary-color);
            background-color: white;
            border-bottom: 3px solid var(--primary-color);
        }
        
        /* Loading Spinner */
        #spinner {
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: rgba(255, 255, 255, 0.9);
            z-index: 9999;
        }
        
        .spinner-grow {
            width: 3rem;
            height: 3rem;
        }
        
        /* Back to Top Button */
        .back-to-top {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 999;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
            background: var(--bg-gradient);
            border: none;
            color: white;
        }
        
        .back-to-top.active {
            opacity: 1;
            visibility: visible;
        }
        
        .back-to-top:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(94, 53, 177, 0.3);
        }
        
        /* Toast Notifications */
        .toast-container {
            position: fixed;
            top: 1.5rem;
            right: 1.5rem;
            z-index: 1100;
        }
        
        .toast {
            border: none;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border-radius: 10px;
            overflow: hidden;
        }
        
        .toast-header {
            font-weight: 600;
        }
        
        /* Community Cards */
        .community-card {
            transition: all 0.3s ease;
            border: none;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            height: 100%;
            display: flex;
            flex-direction: column;
        }
        
        .community-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        
        .community-card-img {
            height: 200px;
            object-fit: cover;
            border-radius: 8px 8px 0 0;
        }
        
        .community-card-body {
            flex: 1;
            padding: 1.5rem;
        }
        
        .community-card-footer {
            background: transparent;
            border-top: 1px solid #e0e0e0;
            padding: 1rem 1.5rem;
            border-radius: 0 0 8px 8px;
        }
        
        /* User Avatar */
        .user-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid var(--light-color);
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }
        
        /* Breadcrumb */
        .breadcrumb {
            background: transparent;
            padding: 0.5rem 0;
            margin-bottom: 1.5rem;
        }
        
        .breadcrumb-item.active {
            color: var(--primary-color);
            font-weight: 500;
        }
        
        /* Responsive Adjustments */
        @media (max-width: 1200px) {
            .hero-title {
                font-size: 2.8rem;
            }
            
            .hero-subtitle {
                font-size: 1.1rem;
            }
        }
        
        @media (max-width: 992px) {
            .hero-title {
                font-size: 2.5rem;
            }
            
            .sidebar {
                position: static;
                height: auto;
            }
            
            #drawingCanvas {
                height: 400px;
            }
        }
        
        @media (max-width: 768px) {
            .hero-title {
                font-size: 2rem;
            }
            
            .hero-subtitle {
                font-size: 1rem;
            }
            
            .game-controls {
                flex-direction: column;
            }
            
            .game-timer, .accuracy-display {
                font-size: 0.9rem;
                padding: 0.5rem 1rem;
            }
            
            .timer-bar, .accuracy-bar {
                width: 80px;
            }
        }
        
        @media (max-width: 576px) {
            .hero-title {
                font-size: 1.8rem;
            }
            
            .points-display, .streak-counter {
                font-size: 1rem;
                padding: 0.75rem 1.5rem;
            }
            
            #drawingCanvas {
                height: 350px;
            }
            
            .btn-tool {
                padding: 0.5rem 0.75rem;
                font-size: 0.8rem;
                margin-right: 0.25rem;
                margin-bottom: 0.25rem;
            }
        }
    </style>
</head>

<body>
    <!-- Confetti Canvas -->
    <canvas id="confetti-canvas"></canvas>
    
    <!-- Spinner -->
    <div id="spinner" class="show bg-white position-fixed translate-middle w-100 vh-100 top-50 start-50 d-flex align-items-center justify-content-center">
        <div class="spinner-grow text-primary" role="status">
            <span class="sr-only">Loading...</span>
        </div>
    </div>

    <!-- Hero Section -->
    <div class="hero-section" id="dashboard">
        <div id="particles-js"></div>
        <div class="container text-center py-5 hero-content">
            <h1 class="hero-title" id="typewriter"></h1>
            <p class="hero-subtitle animate__animated animate__fadeIn animate__delay-1s">Unleash your creativity with our gamified studio. Draw, record, write, and earn rewards for your artistic expressions!</p>
            
            <div class="points-display floating animate__animated animate__bounceIn animate__delay-2s">
                <i class="fas fa-coins"></i>
                <span class="counter" id="totalPoints" data-target="{{ user_data.score if user_data and user_data.score else 1 }}"></span>
            </div>
            
            <div class="streak-counter animate__animated animate__fadeIn animate__delay-3s">
                <i class="fas fa-fire"></i>
                <span id="streak-days">0</span>
                <div class="streak-bar">
                    <div class="streak-progress" style="width: 0%"></div>
                </div>
            </div>
            
            <div class="progress-container animate__animated animate__fadeIn animate__delay-3s">
                <div class="progress-bar" data-percent="{{ (user_data.score % 1000) / 10 if user_data and user_data.score else 0 }}" style="width: 0%"></div>
            </div>
            
            <div class="mt-4">
                <a href="#creative-tools" class="btn btn-primary btn-lg me-3">
                    <i class="fas fa-play me-2"></i> Start Creating
                </a>
                <a href="#challenges" class="btn btn-outline-light btn-lg">
                    <i class="fas fa-trophy me-2"></i> View Challenges
                </a>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="container py-5">
        <nav aria-label="breadcrumb">
<!-- Floating Back Button (Horizontally Ovular) -->
<a href="javascript:void(0);" 
   onclick="window.history.back();"
   class="floating-back-btn" 
   style="position: absolute; 
          top: 15px; 
          left: 35px; 
          background-color: #d9e3e4; 
          color: rgb(67, 210, 210); 
          border-radius: 50px;
          padding: 8px 20px;
          box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2); 
          text-decoration: none; 
          font-size: 16px; 
          transition: all 0.3s;
          display: inline-flex;
          align-items: center;
          justify-content: center;
          width: auto;
          min-width: 40px;
          height: 40px;
          cursor: pointer;">
    <i class="fas fa-arrow-left" style="margin-right: 8px;"></i>
    <span style="white-space: nowrap;"></span>
</a>
        </nav>
        
        <div class="main-container">
            <!-- Sidebar -->
            <div class="sidebar">
                <!-- User Profile Card -->
                <div class="dashboard-card mb-4">
                    <div class="d-flex align-items-center mb-4">
                        <img src="https://ui-avatars.com/api/?name={{ user_data.username }}&background=5e35b1&color=fff" alt="User" class="user-avatar me-3 shadow">
                        <div>
                            <h5 class="mb-1">{{ user_data.username }}</h5>
                            <p class="text-muted mb-0">Creative Explorer</p>
                            <small class="text-primary"><i class="fas fa-medal me-1"></i> Level {{ (user_data.score // 100) + 1 if user_data and user_data.score else 1 }}</small>
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <h6 class="card-title"><i class="fas fa-award me-2"></i>Your Badges</h6>
                        <div id="badgeList" class="badge-container">
                            {% if user_data.badges %}
                                {% for badge in user_data.badges.split(',') %}
                                    <div class="badge-item {% if 'Gold' in badge %}gold{% elif 'Silver' in badge %}silver{% elif 'Bronze' in badge %}bronze{% endif %}">
                                        <i class="fas fa-award"></i>
                                        {{ badge }}
                                    </div>
                                {% endfor %}
                            {% else %}
                                <div class="badge-item">
                                    <i class="fas fa-star"></i>
                                    Newcomer
                                </div>
                            {% endif %}
                        </div>
                    </div>
                    
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="card-title"><i class="fas fa-chart-line me-2"></i>Stats</h6>
                            <div class="d-flex text-center">
                                <div class="px-3">
                                    <div class="h5 mb-0">{{ user_data.drawings_count if user_data and user_data.drawings_count else 0 }}</div>
                                    <small class="text-muted">Drawings</small>
                                </div>
                                <div class="px-3">
                                    <div class="h5 mb-0">{{ user_data.recordings_count if user_data and user_data.recordings_count else 0 }}</div>
                                    <small class="text-muted">Recordings</small>
                                </div>
                                <div class="px-3">
                                    <div class="h5 mb-0">{{ user_data.writings_count if user_data and user_data.writings_count else 0 }}</div>
                                    <small class="text-muted">Writings</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
<!-- Leaderboard Card -->
<div class="dashboard-card" style="background: #ffffff; border-radius: 10px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08); padding: 20px; margin-bottom: 20px;">
    <h6 class="card-title" style="font-size: 1.1rem; font-weight: 600; color: #2d3748; margin-bottom: 15px; display: flex; align-items: center;">
        <i class="fas fa-trophy me-2" style="color: #f6c23e;"></i>🏆 Leaderboard
    </h6>
    <div class="table-responsive" style="overflow-x: auto;">
        <table class="leaderboard-table" style="width: 100%; border-collapse: collapse; margin-bottom: 15px;">
            <thead>
                <tr style="background-color: #f8f9fc;">
                    <th style="padding: 12px 15px; text-align: left; font-weight: 600; color: #4a5568; border-bottom: 2px solid #e2e8f0;">Rank</th>
                    <th style="padding: 12px 15px; text-align: left; font-weight: 600; color: #4a5568; border-bottom: 2px solid #e2e8f0;">User</th>
                    <th style="padding: 12px 15px; text-align: left; font-weight: 600; color: #4a5568; border-bottom: 2px solid #e2e8f0;">Points</th>
                </tr>
            </thead>
            <tbody>
                {% for player in leaderboard_data %}
                <tr class="rank-{{ loop.index }}" style="border-bottom: 1px solid #edf2f7; transition: background-color 0.2s;">
                    <td style="padding: 12px 15px; color: #4a5568;">
                        <span class="rank-icon" style="display: inline-flex; align-items: center; justify-content: center; width: 24px; height: 24px;">
                            {% if loop.index == 1 %}<i class="fas fa-trophy" style="color: #f6c23e;"></i>
                            {% elif loop.index == 2 %}<i class="fas fa-medal" style="color: #a0aec0;"></i>
                            {% elif loop.index == 3 %}<i class="fas fa-award" style="color: #b7793a;"></i>
                            {% else %}{{ loop.index }}{% endif %}
                        </span>
                    </td>
                    <td style="padding: 12px 15px; color: #4a5568;">
                        {% if loop.index <= 3 %}
                        <strong style="font-weight: 600;">{{ player.username }}</strong>
                        {% else %}
                        {{ player.username }}
                        {% endif %}
                    </td>
                    <td style="padding: 12px 15px; color: #4a5568; font-weight: {% if loop.index <= 3 %}600{% else %}500{% endif %};">
                        {{ player.score }}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        <div style="width: 100%; max-width: 300px; margin: 0 auto;">
            <a href="{{ url_for('leaderboard') }}" 
               style="display: block; background: linear-gradient(135deg, #48bb78, #38a169); 
                      color: white; text-align: center; padding: 12px; 
                      border-radius: 8px; text-decoration: none; font-weight: 500;
                      transition: transform 0.2s, box-shadow 0.2s;
                      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);">
                <i class="fas fa-trophy me-2"></i>View Full Leaderboard
            </a>
        </div>
    </div>
</div>
                
                <!-- Quick Actions -->
                <div class="dashboard-card">
                    <h6 class="card-title"><i class="fas fa-bolt me-2"></i>Quick Actions</h6>
                    <div class="d-grid gap-2">
                        <a href="#drawing" class="btn btn-outline-primary">
                            <i class="fas fa-paint-brush me-2"></i> New Drawing
                        </a>
                        <a href="#voice" class="btn btn-outline-primary">
                            <i class="fas fa-microphone me-2"></i> Record Audio
                        </a>
                        <a href="#video" class="btn btn-outline-primary">
                            <i class="fas fa-video me-2"></i> Record Video
                        </a>
                        <a href="#notepad" class="btn btn-outline-primary">
                            <i class="fas fa-edit me-2"></i> Write Note
                        </a>
                    </div>
                </div>
            </div>
            
            <!-- Main Content Area -->
            <div class="content-area" id="creative-tools">
                <!-- Tools Navigation -->
                <ul class="nav nav-tabs" id="creativeTabs" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="drawing-tab" data-bs-toggle="tab" data-bs-target="#drawing" type="button" role="tab" aria-controls="drawing" aria-selected="true">
                            <i class="fas fa-paint-brush me-1"></i> Drawing
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="voice-tab" data-bs-toggle="tab" data-bs-target="#voice" type="button" role="tab" aria-controls="voice" aria-selected="false">
                            <i class="fas fa-microphone me-1"></i> Voice
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="video-tab" data-bs-toggle="tab" data-bs-target="#video" type="button" role="tab" aria-controls="video" aria-selected="false">
                            <i class="fas fa-video me-1"></i> Video
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="notepad-tab" data-bs-toggle="tab" data-bs-target="#notepad" type="button" role="tab" aria-controls="notepad" aria-selected="false">
                            <i class="fas fa-edit me-1"></i> Notepad
                        </button>
                    </li>
                </ul>
                
                <!-- Tab Content -->
                <div class="tab-content" id="creativeTabsContent">
                    <!-- Drawing Tab -->
                    <div class="tab-pane fade show active" id="drawing" role="tabpanel" aria-labelledby="drawing-tab">
                        <div class="content-section">
                            <h3 class="section-title"><i class="fas fa-paint-brush me-2"></i> Drawing Board</h3>
                            
                            <div class="mode-toggle mb-4">
                                <button id="freeDrawMode" class="btn-tool active">
                                    <i class="fas fa-pencil-alt me-1"></i> Free Draw
                                </button>
                                <button id="objectGameMode" class="btn-tool">
                                    <i class="fas fa-gamepad me-1"></i> Drawing Game
                                </button>
                                <button id="aiArtMode" class="btn-tool">
                                    <i class="fas fa-robot me-1"></i> AI Art
                                </button>
                            </div>
                            
                            <!-- Game Instructions -->
                            <div id="gameInstructions" class="game-instructions" style="display: none;">
                                <h5><i class="fas fa-info-circle me-2"></i> How to Play</h5>
                                <p>Try to replicate the object shown below as accurately as possible. 
                                You can submit your drawing anytime or wait for the timer to run out. 
                                Your accuracy and speed will determine your score!</p>
                                
                                <div class="difficulty-selector">
                                    <h6>Select Difficulty:</h6>
                                    <button class="btn btn-sm btn-outline-primary difficulty-btn active" data-difficulty="easy">Easy</button>
                                    <button class="btn btn-sm btn-outline-primary difficulty-btn" data-difficulty="medium">Medium</button>
                                    <button class="btn btn-sm btn-outline-primary difficulty-btn" data-difficulty="hard">Hard</button>
                                </div>
                                
                                <div id="targetPreview" class="target-preview">
                                    <p class="text-muted">Preview will appear when game starts</p>
                                </div>
                            </div>
                            
                            <!-- AI Art Instructions -->
                            <div id="aiArtInstructions" class="game-instructions" style="display: none;">
                                <h5><i class="fas fa-robot me-2"></i> AI Art Generator</h5>
                                <p>Describe what you want to draw and let our AI generate a starting point for your artwork!</p>
                                
                                <div class="input-group mb-3">
                                    <input type="text" id="aiPrompt" class="form-control" placeholder="Describe your artwork...">
                                    <button class="btn btn-primary" id="generateArt">
                                        <i class="fas fa-magic me-1"></i> Generate
                                    </button>
                                </div>
                                
                                <div class="ai-examples">
                                    <p class="text-muted">Try prompts like:</p>
                                    <div class="d-flex flex-wrap gap-2">
                                        <span class="badge bg-light text-dark">"A sunset over mountains"</span>
                                        <span class="badge bg-light text-dark">"A futuristic cityscape"</span>
                                        <span class="badge bg-light text-dark">"A portrait of a cat astronaut"</span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Game Container -->
                            <div class="game-container">
                                <canvas id="drawingCanvas" width="700" height="500"></canvas>
                                
                                <!-- Game UI Elements -->
                                <div id="gameTimer" class="game-timer" style="display: none;">
                                    <i class="fas fa-clock me-1"></i> <span id="timeLeft">60</span>s
                                    <div class="timer-bar">
                                        <div class="timer-progress" style="width: 100%"></div>
                                    </div>
                                </div>
                                
                                <div id="accuracyDisplay" class="accuracy-display" style="display: none;">
                                    Accuracy: <span id="accuracyValue">0</span>%
                                    <div class="accuracy-bar">
                                        <div class="accuracy-progress" style="width: 0%"></div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Drawing Tools -->
                            <div class="tool-group">
                                <button id="clearCanvas" class="btn-tool">
                                    <i class="fas fa-trash-alt me-1"></i> Clear
                                </button>
                                <button id="eraser" class="btn-tool">
                                    <i class="fas fa-eraser me-1"></i> Eraser
                                </button>
                                <input type="color" id="colorPicker" value="#000000" class="btn-tool" style="padding: 0; height: 38px;">
                                <input type="range" id="brushSize" min="1" max="50" value="5" class="btn-tool" style="width: 100px;">
                                <button class="btn-tool brush-option" data-texture="watercolor">
                                    <i class="fas fa-tint me-1"></i> Watercolor
                                </button>
                                <button class="btn-tool brush-option" data-texture="chalk">
                                    <i class="fas fa-chalkboard me-1"></i> Chalk
                                </button>
                                <button id="symmetry-toggle" class="btn-tool">
                                    <i class="fas fa-snowflake me-1"></i> Symmetry
                                </button>
                                <button id="takePicture" class="btn-tool">
                                    <i class="fas fa-camera me-1"></i> Save
                                </button>
                                <button id="undo" class="btn-tool">
                                    <i class="fas fa-undo me-1"></i> Undo
                                </button>
                                <button id="redo" class="btn-tool">
                                    <i class="fas fa-redo me-1"></i> Redo
                                </button>
                            </div>
                            
                            <!-- Game Controls -->
                            <div class="game-controls">
                                <button id="submitDrawing" class="btn btn-primary">
                                    <i class="fas fa-paper-plane me-1"></i> Submit Drawing
                                </button>
                                <button id="startGame" class="btn btn-success" style="display: none;">
                                    <i class="fas fa-play me-1"></i> Start Game
                                </button>
                                <button id="endGameEarly" class="btn btn-warning" style="display: none;">
                                    <i class="fas fa-stopwatch me-1"></i> Submit Early
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Voice Tab -->
                    <div class="tab-pane fade" id="voice" role="tabpanel" aria-labelledby="voice-tab">
                        <div class="content-section">
                            <h3 class="section-title"><i class="fas fa-microphone me-2"></i> Voice Recording</h3>
                            <p>Record your voice, sing a song, or recite poetry to earn points!</p>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="button-group mb-4">
                                        <button id="startRecord" class="btn btn-primary me-2">
                                            <i class="fas fa-microphone me-1"></i> Start Recording
                                        </button>
                                        <button id="stopRecord" class="btn btn-danger" disabled>
                                            <i class="fas fa-stop me-1"></i> Stop Recording
                                        </button>
                                    </div>
                                    
                                    <audio id="audioPlayback" controls class="w-100 mb-3"></audio>
                                    
                                    <button id="submitVoice" class="btn btn-success w-100">
                                        <i class="fas fa-paper-plane me-1"></i> Submit Recording
                                    </button>
                                </div>
                                <div class="col-md-6">
                                    <div class="game-instructions">
                                        <h5><i class="fas fa-lightbulb me-2"></i> Voice Challenges</h5>
                                        <ul class="list-group list-group-flush">
                                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                                Sing a song
                                                <span class="badge bg-primary rounded-pill">50 pts</span>
                                            </li>
                                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                                Recite a poem
                                                <span class="badge bg-primary rounded-pill">40 pts</span>
                                            </li>
                                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                                Impersonate a celebrity
                                                <span class="badge bg-primary rounded-pill">60 pts</span>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Video Tab -->
                    <div class="tab-pane fade" id="video" role="tabpanel" aria-labelledby="video-tab">
                        <div class="content-section">
                            <h3 class="section-title"><i class="fas fa-video me-2"></i> Video Recording</h3>
                            <p>Record a video performance to earn points and showcase your talent!</p>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="button-group mb-4">
                                        <button id="startVideoRecord" class="btn btn-primary me-2">
                                            <i class="fas fa-video me-1"></i> Start Recording
                                        </button>
                                        <button id="stopVideoRecord" class="btn btn-danger" disabled>
                                            <i class="fas fa-stop me-1"></i> Stop Recording
                                        </button>
                                    </div>
                                    
                                    <video id="videoPreview" controls class="w-100 rounded mb-3"></video>
                                    
                                    <button id="submitVideo" class="btn btn-success w-100">
                                        <i class="fas fa-paper-plane me-1"></i> Submit Video
                                    </button>
                                </div>
                                <div class="col-md-6">
                                    <div class="game-instructions">
                                        <h5><i class="fas fa-lightbulb me-2"></i> Video Challenges</h5>
                                        <ul class="list-group list-group-flush">
                                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                                Dance performance
                                                <span class="badge bg-primary rounded-pill">80 pts</span>
                                            </li>
                                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                                Short skit
                                                <span class="badge bg-primary rounded-pill">70 pts</span>
                                            </li>
                                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                                Tutorial video
                                                <span class="badge bg-primary rounded-pill">90 pts</span>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Notepad Tab -->
                    <div class="tab-pane fade" id="notepad" role="tabpanel" aria-labelledby="notepad-tab">
                        <div class="content-section">
                            <h3 class="section-title"><i class="fas fa-edit me-2"></i> Creative Notepad</h3>
                            <p>Write your poetry, stories, or thoughts to earn points!</p>
                            
                            <textarea id="notepadText" placeholder="Write your creative content here..."></textarea>
                            
                            <div class="notepad-tools mt-3">
                                <button id="saveNote" class="btn btn-secondary me-2">
                                    <i class="fas fa-save me-1"></i> Save
                                </button>
                                <button id="clearNote" class="btn btn-secondary me-2">
                                    <i class="fas fa-trash-alt me-1"></i> Clear
                                </button>
                                <button id="submitNote" class="btn btn-success">
                                    <i class="fas fa-paper-plane me-1"></i> Submit
                                </button>
                            </div>
                            
                            <div class="game-instructions mt-4">
                                <h5><i class="fas fa-lightbulb me-2"></i> Writing Prompts</h5>
                                <ul class="list-group list-group-flush">
                                    <li class="list-group-item">Write a short story about a time traveler</li>
                                    <li class="list-group-item">Compose a poem about your favorite season</li>
                                    <li class="list-group-item">Describe your dream vacation destination</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Challenges Section -->
                <div class="content-section mt-4" id="challenges">
                    <h3 class="section-title"><i class="fas fa-tasks me-2"></i> Current Challenges</h3>
                    
                    <div class="table-responsive">
                        <table class="challenges-table">
                            <thead>
                                <tr>
                                    <th>Challenge</th>
                                    <th>Description</th>
                                    <th>Deadline</th>
                                    <th>Reward</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for challenge in challenges %}
                                <tr>
                                    <td><strong>{{ challenge.name }}</strong></td>
                                    <td>{{ challenge.description }}</td>
                                    <td>{{ challenge.deadline }}</td>
                                    <td><span class="badge bg-warning text-dark challenge-reward">{{ challenge.points_reward }} pts</span></td>
                                    <td><button class="btn btn-sm btn-outline-primary">Participate</button></td>
                                </tr>
                                {% else %}
                                <tr>
                                    <td colspan="5" class="text-center">No challenges available at the moment.</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Community Section -->
                <div class="content-section mt-4" id="community">
                    <h3 class="section-title"><i class="fas fa-users me-2"></i> Community Creations</h3>
                    
                    <div class="row">
                        <div class="col-md-4 mb-4">
                            <div class="card community-card">
                                <img src="{{ url_for('static', filename='img/community-1.jpg') }}" class="card-img-top community-card-img" alt="Community Art">
                                <div class="card-body">
                                    <h5 class="card-title">Sunset Landscape</h5>
                                    <p class="card-text">By: CreativeArtist123</p>
                                    <div class="d-flex justify-content-between align-items-center">
                                        <span class="badge bg-primary">Drawing</span>
                                        <small class="text-muted">2 days ago</small>
                                    </div>
                                </div>
                                <div class="community-card-footer">
                                    <button class="btn btn-sm btn-outline-primary me-2"><i class="fas fa-thumbs-up"></i> 24</button>
                                    <button class="btn btn-sm btn-outline-secondary"><i class="fas fa-comment"></i> 5</button>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 mb-4">
                            <div class="card community-card">
                                <img src="{{ url_for('static', filename='img/community-2.jpg') }}" class="card-img-top community-card-img" alt="Community Art">
                                <div class="card-body">
                                    <h5 class="card-title">Abstract Thoughts</h5>
                                    <p class="card-text">By: ArtLover456</p>
                                    <div class="d-flex justify-content-between align-items-center">
                                        <span class="badge bg-primary">Drawing</span>
                                        <small class="text-muted">1 week ago</small>
                                    </div>
                                </div>
                                <div class="community-card-footer">
                                    <button class="btn btn-sm btn-outline-primary me-2"><i class="fas fa-thumbs-up"></i> 42</button>
                                    <button class="btn btn-sm btn-outline-secondary"><i class="fas fa-comment"></i> 8</button>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 mb-4">
                            <div class="card community-card">
                                <img src="{{ url_for('static', filename='img/community-3.jpg') }}" class="card-img-top community-card-img" alt="Community Art">
                                <div class="card-body">
                                    <h5 class="card-title">Portrait Study</h5>
                                    <p class="card-text">By: SketchMaster</p>
                                    <div class="d-flex justify-content-between align-items-center">
                                        <span class="badge bg-primary">Drawing</span>
                                        <small class="text-muted">3 days ago</small>
                                    </div>
                                </div>
                                <div class="community-card-footer">
                                    <button class="btn btn-sm btn-outline-primary me-2"><i class="fas fa-thumbs-up"></i> 18</button>
                                    <button class="btn btn-sm btn-outline-secondary"><i class="fas fa-comment"></i> 3</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="text-center mt-3">
                        <button class="btn btn-primary">
                            <i class="fas fa-eye me-1"></i> View More Creations
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Back to Dashboard -->
    <div class="text-center mt-5 mb-5">
        <a href="{{ url_for('admindashboard') if username in ['smuggerteey', 'cicada403'] else ('dashboard' if user_data['role'] == 'Artist' else 'userdashboard') }}" 
           class="btn btn-secondary dashboard-btn">
            <i class="fas fa-arrow-left me-2"></i> Go Back
        </a>
    </div>

    <!-- Footer Start -->
    <div class="container-fluid bg-dark text-light footer pt-5 mt-5 wow fadeIn" data-wow-delay="0.1s">
        <div class="container py-5">
            <div class="row g-5">
                <div class="col-lg-3 col-md-6">
                    <h4 class="text-white mb-3">Quick Link</h4>
                    <a class="btn btn-link" href="">About Us</a>
                    <a class="btn btn-link" href="">Contact Us</a>
                    <a class="btn btn-link" href="">Privacy Policy</a>
                    <a class="btn btn-link" href="">Terms & Condition</a>
                    <a class="btn btn-link" href="">FAQs & Help</a>
                </div>
                <div class="col-lg-3 col-md-6">
                    <h4 class="text-white mb-3">Contact</h4>
                    <p class="mb-2"><i class="fa fa-map-marker-alt me-3"></i>1 Avenue, Brekuso, ER, Ghana</p>
                    <p class="mb-2"><i class="fa fa-phone-alt me-3"></i>+233203419613</p>
                    <p class="mb-2"><i class="fa fa-envelope me-3"></i>infor@creativeshowcase.com</p>
                    <div class="d-flex pt-2">
                        <a class="btn btn-outline-light btn-social" href=""><i class="fab fa-twitter"></i></a>
                        <a class="btn btn-outline-light btn-social" href=""><i class="fab fa-facebook-f"></i></a>
                        <a class="btn btn-outline-light btn-social" href=""><i class="fab fa-youtube"></i></a>
                        <a class="btn btn-outline-light btn-social" href=""><i class="fab fa-linkedin-in"></i></a>
                    </div>
                </div>
                <div class="col-lg-3 col-md-6">
                    <h4 class="text-white mb-3">Gallery</h4>
                    <div class="row g-2 pt-2">
                        <div class="col-4">
                            <img class="img-fluid bg-light p-1" src="{{ url_for('static', filename='img/course-1.jpg') }}" alt="">
                        </div>
                        <div class="col-4">
                            <img class="img-fluid bg-light p-1" src="{{ url_for('static', filename='img/course-2.jpg') }}" alt="">
                        </div>
                        <div class="col-4">
                            <img class="img-fluid bg-light p-1" src="{{ url_for('static', filename='img/course-3.jpg') }}" alt="">
                        </div>
                        <div class="col-4">
                            <img class="img-fluid bg-light p-1" src="{{ url_for('static', filename='img/course-2.jpg') }}" alt="">
                        </div>
                        <div class="col-4">
                            <img class="img-fluid bg-light p-1" src="{{ url_for('static', filename='img/course-3.jpg') }}" alt="">
                        </div>
                        <div class="col-4">
                            <img class="img-fluid bg-light p-1" src="{{ url_for('static', filename='img/course-1.jpg') }}" alt="">
                        </div>
                    </div>
                </div>
                <div class="col-lg-3 col-md-6">
                    <h4 class="text-white mb-3">Newsletter</h4>
                    <p>Sign up for creative inspiration and updates.</p>
                    <div class="position-relative mx-auto" style="max-width: 400px;">
                        <input class="form-control border-0 w-100 py-3 ps-4 pe-5" type="text" placeholder="Your email">
                        <button type="button" class="btn btn-primary py-2 position-absolute top-0 end-0 mt-2 me-2">SignUp</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="container">
            <div class="copyright">
                <div class="row">
                    <div class="col-md-6 text-center text-md-start mb-3 mb-md-0">
                        &copy; <a class="border-bottom" href="#">Creative Hub</a>, All Right Reserved.
                    </div>
                    <div class="col-md-6 text-center text-md-end">
                        <div class="footer-menu">
                            <a href="">Home</a>
                            <a href="">Cookies</a>
                            <a href="">Help</a>
                            <a href="">FQAs</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Footer End -->

    <!-- Back to Top -->
    <a href="#" class="back-to-top"><i class="bi bi-arrow-up"></i></a>

    <!-- JavaScript Libraries -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{{ url_for('static', filename='lib/wow/wow.min.js') }}"></script>
    <script src="{{ url_for('static', filename='lib/easing/easing.min.js') }}"></script>
    <script src="{{ url_for('static', filename='lib/waypoints/waypoints.min.js') }}"></script>
    <script src="{{ url_for('static', filename='lib/owlcarousel/owl.carousel.min.js') }}"></script>

    <!-- Template Javascript -->
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
    
    <script>
        // Enhanced Creative Hub with all improvements
        document.addEventListener('DOMContentLoaded', function() {
            // Global variables for the game
            let totalPoints = {{ user_data.score if user_data and user_data.score else 0 }};
            let gameActive = false;
            let gameTimer;
            let timeLeft = 60;
            let currentDifficulty = 'easy';
            let targetObject = null;
            let drawingHistory = [];
            let lastAccuracyCheck = 0;
            let badges = [];
            let canvas;
            let confettiSettings = { 
                target: 'confetti-canvas', 
                max: 150, 
                size: 1.5, 
                animate: true,
                props: ['circle', 'square', 'triangle', 'line'],
                colors: [[255,108,108], [108,108,255], [108,255,108], [255,255,108], [108,255,255], [255,108,255]]
            };
            let confetti = new ConfettiGenerator(confettiSettings);
            let undoStack = [];
            let redoStack = [];
            let currentDrawing = null;
            let currentMode = 'free';
            let symmetryEnabled = false;
            let symmetryMode = 'vertical'; // 'vertical', 'horizontal', 'radial'

            // Initialize user data
            function initUserData() {
                // Initialize Typed.js for hero title
                new Typed('#typewriter', {
                    strings: ['Unleash Your Creativity', 'Express Yourself', 'Make Masterpieces', 'Earn Rewards', 'Join the Community'],
                    typeSpeed: 120,
                    backSpeed: 800,
                    loop: true,
                    showCursor: true,
                    cursorChar: '|',
                    autoInsertCss: true
                });

                // Initialize particles.js
                particlesJS.load('particles-js', {
                    "particles": {
                        "number": {
                            "value": 100,
                            "density": {
                                "enable": true,
                                "value_area": 800
                            }
                        },
                        "color": {
                            "value": "#5e35b1"
                        },
                        "shape": {
                            "type": "circle",
                            "stroke": {
                                "width": 0,
                                "color": "#000000"
                            },
                            "polygon": {
                                "nb_sides": 5
                            }
                        },
                        "opacity": {
                            "value": 0.5,
                            "random": false,
                            "anim": {
                                "enable": false,
                                "speed": 1,
                                "opacity_min": 0.1,
                                "sync": false
                            }
                        },
                        "size": {
                            "value": 3,
                            "random": true,
                            "anim": {
                                "enable": false,
                                "speed": 40,
                                "size_min": 0.1,
                                "sync": false
                            }
                        },
                        "line_linked": {
                            "enable": true,
                            "distance": 150,
                            "color": "#5e35b1",
                            "opacity": 0.4,
                            "width": 1
                        },
                        "move": {
                            "enable": true,
                            "speed": 2,
                            "direction": "none",
                            "random": false,
                            "straight": false,
                            "out_mode": "out",
                            "bounce": false,
                            "attract": {
                                "enable": false,
                                "rotateX": 600,
                                "rotateY": 1200
                            }
                        }
                    },
                    "interactivity": {
                        "detect_on": "canvas",
                        "events": {
                            "onhover": {
                                "enable": true,
                                "mode": "grab"
                            },
                            "onclick": {
                                "enable": true,
                                "mode": "push"
                            },
                            "resize": true
                        },
                        "modes": {
                            "grab": {
                                "distance": 140,
                                "line_linked": {
                                    "opacity": 1
                                }
                            },
                            "bubble": {
                                "distance": 400,
                                "size": 40,
                                "duration": 2,
                                "opacity": 8,
                                "speed": 3
                            },
                            "repulse": {
                                "distance": 200,
                                "duration": 0.4
                            },
                            "push": {
                                "particles_nb": 4
                            },
                            "remove": {
                                "particles_nb": 2
                            }
                        }
                    },
                    "retina_detect": true
                });

                // Animate points counter
                const pointsCounter = document.querySelector('.counter');
                const targetPoints = parseInt(pointsCounter.getAttribute('data-target'));
                let currentCount = 0;
                const increment = targetPoints / 50;
                
                const updateCounter = () => {
                    currentCount += increment;
                    pointsCounter.textContent = Math.floor(currentCount);
                    
                    if (currentCount < targetPoints) {
                        setTimeout(updateCounter, 20);
                    } else {
                        pointsCounter.textContent = targetPoints;
                    }
                };
                
                updateCounter();

                // Animate progress bar
                const progressBar = document.querySelector('.progress-bar');
                const targetPercent = parseFloat(progressBar.getAttribute('data-percent'));
                let currentPercent = 0;
                const progressIncrement = targetPercent / 20;
                
                const updateProgress = () => {
                    currentPercent += progressIncrement;
                    progressBar.style.width = `${currentPercent}%`;
                    
                    if (currentPercent < targetPercent) {
                        setTimeout(updateProgress, 50);
                    }
                };
                
                updateProgress();

                // Initialize streak system
                updateStreak();
                
                // Initialize badges from HTML (already rendered server-side)
                badges = Array.from(document.querySelectorAll('.badge-item')).map(badge => badge.textContent.trim());
            }

            // Streak system
            function updateStreak() {
                const lastVisit = localStorage.getItem('lastVisit');
                const today = new Date().toDateString();
                
                if (lastVisit === today) {
                    // Already visited today
                    document.getElementById('streak-days').textContent = localStorage.getItem('streak') || '1';
                    document.querySelector('.streak-progress').style.width = '100%';
                    return;
                }
                
                if (!lastVisit || new Date(today) - new Date(lastVisit) > 86400000) {
                    // Reset streak if more than 1 day gap
                    localStorage.setItem('streak', '1');
                } else {
                    // Increment streak
                    const currentStreak = parseInt(localStorage.getItem('streak')) || 0;
                    localStorage.setItem('streak', (currentStreak + 1).toString());
                    
                    // Award bonus points for streaks
                    if ((currentStreak + 1) % 7 === 0) {
                        updatePoints(100);
                        showStreakBonus(currentStreak + 1);
                    }
                }
                
                localStorage.setItem('lastVisit', today);
                document.getElementById('streak-days').textContent = localStorage.getItem('streak');
                
                // Animate streak progress
                let streakWidth = 0;
                const streakInterval = setInterval(() => {
                    streakWidth += 5;
                    document.querySelector('.streak-progress').style.width = `${Math.min(streakWidth, 100)}%`;
                    
                    if (streakWidth >= 100) {
                        clearInterval(streakInterval);
                    }
                }, 30);
            }

            function showStreakBonus(days) {
                const streakBonus = document.createElement('div');
                streakBonus.className = 'streak-bonus animate__animated animate__bounceIn';
                streakBonus.innerHTML = `
                    <div class="streak-fire">
                        <i class="fas fa-fire"></i>
                        <span>${days}-day streak!</span>
                    </div>
                    <div class="streak-points">+100 points</div>
                `;
                document.body.appendChild(streakBonus);
                
                setTimeout(() => {
                    streakBonus.classList.add('animate__fadeOutUp');
                    setTimeout(() => streakBonus.remove(), 1000);
                }, 3000);
                
                // Fire confetti
                confetti.render();
                setTimeout(() => {
                    confetti.clear();
                }, 3000);
            }

            // Enhanced updatePoints function with database sync
            function updatePoints(points) {
                totalPoints += points;
                updatePointsDisplay();
                updateProgressBar();
                checkBadges();

                // Update counter animation
                const pointsDisplay = document.getElementById('totalPoints');
                const targetPoints = parseInt(pointsDisplay.textContent);
                let currentCount = targetPoints - points;
                const increment = points / 10;
                
                const updateCounter = () => {
                    currentCount += increment;
                    pointsDisplay.textContent = Math.floor(currentCount);
                    
                    if (currentCount < targetPoints) {
                        setTimeout(updateCounter, 50);
                    } else {
                        pointsDisplay.textContent = targetPoints;
                    }
                };
                
                updateCounter();

                // Update in database
                fetch('/update_points', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ 
                        username: '{{ user_data.username }}', 
                        points: points 
                    }),
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success && data.newBadges) {
                        // Update badges if new ones were awarded
                        badges = data.newBadges.split(',');
                        updateBadges();
                        
                        // Show notification for each new badge
                        data.newBadges.split(',').forEach(badge => {
                            if (!document.querySelector(`.badge-item:contains('${badge}')`)) {
                                showBadgeNotification(badge);
                            }
                        });
                    }
                });
            }

            function updatePointsDisplay() {
                // Handled by the counter animation
            }

            function updateProgressBar() {
                const progressBar = document.querySelector('.progress-bar');
                const progress = (totalPoints % 1000) / 10;
                
                // Animate progress
                let currentWidth = parseFloat(progressBar.style.width) || 0;
                const targetWidth = progress;
                const increment = (targetWidth - currentWidth) / 10;
                
                const animateProgress = () => {
                    currentWidth += increment;
                    progressBar.style.width = `${currentWidth}%`;
                    
                    if (Math.abs(currentWidth - targetWidth) > 1) {
                        requestAnimationFrame(animateProgress);
                    }
                };
                
                animateProgress();
            }

            function checkBadges() {
                const newBadges = [];
                
                if (totalPoints >= 100 && !badges.includes("First Drawing")) {
                    newBadges.push("First Drawing");
                }
                if (totalPoints >= 500 && !badges.includes("Master Artist")) {
                    newBadges.push("Master Artist");
                }
                if (totalPoints >= 1000 && !badges.includes("Creative Guru")) {
                    newBadges.push("Creative Guru");
                }
                if (totalPoints >= 2000 && !badges.includes("Art Legend")) {
                    newBadges.push("Art Legend");
                }
                if (totalPoints >= 5000 && !badges.includes("Ultimate Creator")) {
                    newBadges.push("Ultimate Creator");
                }
                
                if (newBadges.length > 0) {
                    badges = [...badges, ...newBadges];
                    updateBadges();
                    
                    // Show notifications for new badges
                    newBadges.forEach(badge => {
                        showBadgeNotification(badge);
                    });
                }
            }

            function showBadgeNotification(badgeName) {
                // Create notification element
                const notification = document.createElement('div');
                notification.className = 'position-fixed bottom-0 end-0 p-3';
                notification.style.zIndex = '11';
                
                notification.innerHTML = `
                    <div id="badgeToast" class="toast show" role="alert" aria-live="assertive" aria-atomic="true">
                        <div class="toast-header bg-primary text-white">
                            <strong class="me-auto">New Badge Unlocked!</strong>
                            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="toast" aria-label="Close"></button>
                        </div>
                        <div class="toast-body bg-light">
                            <div class="d-flex align-items-center">
                                <i class="fas fa-award text-warning me-3" style="font-size: 2rem;"></i>
                                <div>
                                    <h6 class="mb-1">${badgeName}</h6>
                                    <p class="mb-0">Congratulations! You've earned a new badge.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(notification);
                
                // Fire confetti
                confetti.render();
                setTimeout(() => {
                    confetti.clear();
                }, 3000);
                
                // Auto-remove after 5 seconds
                setTimeout(() => {
                    notification.remove();
                }, 5000);
            }

            function updateBadges() {
                const badgeList = document.getElementById('badgeList');
                badgeList.innerHTML = badges.map(badge => `
                    <div class="badge-item animate__animated animate__fadeIn ${badge.includes('Gold') ? 'gold' : badge.includes('Silver') ? 'silver' : badge.includes('Bronze') ? 'bronze' : ''}">
                        <i class="fas fa-award"></i>
                        ${badge}
                    </div>
                `).join('');
            }

            // Enhanced Drawing Board with Game Features and empty drawing validation
            function initDrawingBoard() {
                canvas = new fabric.Canvas('drawingCanvas', {
                    isDrawingMode: true,
                    backgroundColor: '#ffffff'
                });
                
                // Set initial drawing settings
                canvas.freeDrawingBrush.color = '#000000';
                canvas.freeDrawingBrush.width = 5;

                // Track drawing history for undo/redo
                canvas.on('path:created', function(e) {
                    undoStack.push(e.path);
                    redoStack = []; // Clear redo stack when new action is performed
                    currentDrawing = e.path;
                    
                    // If symmetry is enabled, create mirrored path
                    if (symmetryEnabled) {
                        const originalPath = e.path;
                        const centerX = canvas.width / 2;
                        const centerY = canvas.height / 2;
                        
                        // Clone the path and transform it based on symmetry mode
                        const mirroredPath = new fabric.Path(originalPath.path, {
                            stroke: originalPath.stroke,
                            strokeWidth: originalPath.strokeWidth,
                            fill: originalPath.fill,
                            opacity: originalPath.opacity,
                            selectable: false
                        });
                        
                        // Apply symmetry transformation
                        if (symmetryMode === 'vertical') {
                            mirroredPath.scaleX = -1;
                            mirroredPath.left = centerX - (originalPath.left - centerX) - originalPath.width;
                            mirroredPath.top = originalPath.top;
                        } else if (symmetryMode === 'horizontal') {
                            mirroredPath.scaleY = -1;
                            mirroredPath.left = originalPath.left;
                            mirroredPath.top = centerY - (originalPath.top - centerY) - originalPath.height;
                        } else if (symmetryMode === 'radial') {
                            mirroredPath.scaleX = -1;
                            mirroredPath.scaleY = -1;
                            mirroredPath.left = centerX - (originalPath.left - centerX) - originalPath.width;
                            mirroredPath.top = centerY - (originalPath.top - centerY) - originalPath.height;
                        }
                        
                        canvas.add(mirroredPath);
                        undoStack.push(mirroredPath);
                    }
                });

                // Tool event listeners
                document.getElementById('colorPicker').addEventListener('change', (e) => {
                    canvas.freeDrawingBrush.color = e.target.value;
                });

                document.getElementById('brushSize').addEventListener('input', (e) => {
                    canvas.freeDrawingBrush.width = parseInt(e.target.value, 10);
                });

                document.getElementById('clearCanvas').addEventListener('click', () => {
                    Swal.fire({
                        title: 'Clear Canvas?',
                        text: 'Are you sure you want to clear your drawing?',
                        icon: 'warning',
                        showCancelButton: true,
                        confirmButtonText: 'Yes, clear it!',
                        background: 'rgba(255,255,255,0.95)',
                        backdrop: `
                            rgba(0,0,0,0.4)
                            url("/static/img/confetti.gif")
                            center top
                            no-repeat
                        `
                    }).then((result) => {
                        if (result.isConfirmed) {
                            canvas.clear();
                            canvas.backgroundColor = '#ffffff';
                            canvas.renderAll();
                            undoStack = [];
                            redoStack = [];
                        }
                    });
                });

                document.getElementById('eraser').addEventListener('click', function() {
                    canvas.freeDrawingBrush.color = '#ffffff';
                });

                document.getElementById('takePicture').addEventListener('click', () => {
                    if (isCanvasEmpty(canvas)) {
                        Swal.fire({
                            title: 'Empty Canvas',
                            text: 'Please draw something before saving!',
                            icon: 'warning',
                            background: 'rgba(255,255,255,0.95)'
                        });
                        return;
                    }
                    
                    const image = canvas.toDataURL('image/png');
                    const link = document.createElement('a');
                    link.href = image;
                    link.download = 'creative-hub-drawing.png';
                    link.click();
                    
                    // Show success message
                    Swal.fire({
                        position: 'top-end',
                        icon: 'success',
                        title: 'Drawing saved!',
                        showConfirmButton: false,
                        timer: 1500,
                        background: 'rgba(255,255,255,0.95)'
                    });
                });

                // Undo functionality
                document.getElementById('undo').addEventListener('click', () => {
                    if (undoStack.length > 0) {
                        const lastPath = undoStack.pop();
                        redoStack.push(lastPath);
                        canvas.remove(lastPath);
                    }
                });

                // Redo functionality
                document.getElementById('redo').addEventListener('click', () => {
                    if (redoStack.length > 0) {
                        const lastPath = redoStack.pop();
                        undoStack.push(lastPath);
                        canvas.add(lastPath);
                    }
                });

                // Enhanced Symmetry toggle
                document.getElementById('symmetry-toggle').addEventListener('click', function() {
                    symmetryEnabled = !symmetryEnabled;
                    this.classList.toggle('active');
                    
                    // Remove any existing guide lines
                    canvas.getObjects().forEach(obj => {
                        if (obj.type === 'line' && obj.stroke === 'rgba(94, 53, 177, 0.5)') {
                            canvas.remove(obj);
                        }
                    });
                    
                    if (symmetryEnabled) {
                        // Show symmetry mode selector
                        Swal.fire({
                            title: 'Select Symmetry Mode',
                            html: `
                                <div class="d-flex justify-content-center gap-3 my-3">
                                    <button id="verticalSymmetry" class="btn btn-outline-primary">
                                        <i class="fas fa-arrows-alt-h fa-2x"></i><br>
                                        Vertical
                                    </button>
                                    <button id="horizontalSymmetry" class="btn btn-outline-primary">
                                        <i class="fas fa-arrows-alt-v fa-2x"></i><br>
                                        Horizontal
                                    </button>
                                    <button id="radialSymmetry" class="btn btn-outline-primary">
                                        <i class="fas fa-snowflake fa-2x"></i><br>
                                        Radial
                                    </button>
                                </div>
                            `,
                            showConfirmButton: false,
                            background: 'rgba(255,255,255,0.95)'
                        });
                        
                        document.getElementById('verticalSymmetry').addEventListener('click', () => {
                            symmetryMode = 'vertical';
                            addSymmetryGuide();
                            Swal.close();
                        });
                        
                        document.getElementById('horizontalSymmetry').addEventListener('click', () => {
                            symmetryMode = 'horizontal';
                            addSymmetryGuide();
                            Swal.close();
                        });
                        
                        document.getElementById('radialSymmetry').addEventListener('click', () => {
                            symmetryMode = 'radial';
                            addSymmetryGuide();
                            Swal.close();
                        });
                    }
                });
                
                function addSymmetryGuide() {
                    const centerX = canvas.width / 2;
                    const centerY = canvas.height / 2;
                    
                    if (symmetryMode === 'vertical') {
                        // Add vertical center line guide
                        const centerLine = new fabric.Line([centerX, 0, centerX, canvas.height], {
                            stroke: 'rgba(94, 53, 177, 0.5)',
                            strokeWidth: 1,
                            selectable: false,
                            evented: false
                        });
                        canvas.add(centerLine);
                    } else if (symmetryMode === 'horizontal') {
                        // Add horizontal center line guide
                        const centerLine = new fabric.Line([0, centerY, canvas.width, centerY], {
                            stroke: 'rgba(94, 53, 177, 0.5)',
                            strokeWidth: 1,
                            selectable: false,
                            evented: false
                        });
                        canvas.add(centerLine);
                    } else if (symmetryMode === 'radial') {
                        // Add both vertical and horizontal lines for radial symmetry
                        const vLine = new fabric.Line([centerX, 0, centerX, canvas.height], {
                            stroke: 'rgba(94, 53, 177, 0.5)',
                            strokeWidth: 1,
                            selectable: false,
                            evented: false
                        });
                        const hLine = new fabric.Line([0, centerY, canvas.width, centerY], {
                            stroke: 'rgba(94, 53, 177, 0.5)',
                            strokeWidth: 1,
                            selectable: false,
                            evented: false
                        });
                        canvas.add(vLine);
                        canvas.add(hLine);
                    }
                    
                    canvas.renderAll();
                }

                // Brush texture options
                document.querySelectorAll('.brush-option').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const texture = this.getAttribute('data-texture');
                        
                        // In a real app, you would implement custom brush textures
                        // For demo purposes, we'll just change the cursor
                        canvas.freeDrawingBrush = new fabric[texture === 'watercolor' ? 'CircleBrush' : 'PencilBrush'](canvas);
                        
                        // Visual feedback
                        this.classList.add('active');
                        setTimeout(() => {
                            this.classList.remove('active');
                        }, 200);
                        
                        Swal.fire({
                            title: `${texture.charAt(0).toUpperCase() + texture.slice(1)} Brush`,
                            text: `Now using ${texture} brush style!`,
                            icon: 'info',
                            timer: 1000,
                            showConfirmButton: false,
                            background: 'rgba(255,255,255,0.95)'
                        });
                    });
                });

                // Enhanced submit drawing with empty canvas validation
                document.getElementById('submitDrawing').addEventListener('click', () => {
                    if (gameActive) {
                        Swal.fire({
                            title: 'Game in Progress',
                            text: 'Please finish or cancel the current game first.',
                            icon: 'warning',
                            background: 'rgba(255,255,255,0.95)'
                        });
                        return;
                    }
                    
                    // Check if canvas is empty
                    if (isCanvasEmpty(canvas)) {
                        Swal.fire({
                            title: 'Empty Canvas',
                            text: 'Please draw something before submitting!',
                            icon: 'warning',
                            background: 'rgba(255,255,255,0.95)'
                        });
                        return;
                    }
                    
                    const points = calculateDrawingPoints(canvas);
                    Swal.fire({
                        title: 'Drawing Submitted!',
                        html: `You've earned <strong>${points} points</strong>!<br><br>
                               <small>Points are awarded based on drawing complexity and detail.</small>`,
                        icon: 'success',
                        confirmButtonText: 'Awesome!',
                        background: 'rgba(255,255,255,0.95)',
                        backdrop: `
                            rgba(0,0,0,0.4)
                            url("/static/img/confetti.gif")
                            center top
                            no-repeat
                        `
                    });
                    updatePoints(points);
                    
                    // Update drawings count in database
                    updateUserStat('drawings_count');
                });

                // Function to check if canvas is empty
                function isCanvasEmpty(canvas) {
                    // Check if there are any objects besides the background
                    const objects = canvas.getObjects();
                    return objects.length === 0 || 
                          (objects.length === 1 && objects[0] === targetObject);
                }

                // Function to calculate points based on drawing complexity
                function calculateDrawingPoints(canvas) {
                    const objects = canvas.getObjects();
                    
                    // Filter out the target object if in game mode
                    const drawingObjects = objects.filter(obj => obj !== targetObject);
                    
                    if (drawingObjects.length === 0) return 0;
                    
                    // Base points
                    let points = 20;
                    
                    // Add points for complexity (more paths = more points)
                    points += Math.min(drawingObjects.length * 2, 50);
                    
                    // Add points for color variety
                    const colors = new Set();
                    drawingObjects.forEach(obj => {
                        if (obj.stroke) colors.add(obj.stroke);
                    });
                    points += Math.min(colors.size * 5, 20);
                    
                    // Add points for brush size variety
                    const sizes = new Set();
                    drawingObjects.forEach(obj => {
                        if (obj.strokeWidth) sizes.add(obj.strokeWidth);
                    });
                    points += Math.min(sizes.size * 3, 15);
                    
                    // Random bonus to make it feel dynamic
                    points += Math.floor(Math.random() * 15);
                    
                    return Math.min(points, 100); // Cap at 100 points for free drawing
                }

                // Mode toggle
                document.getElementById('freeDrawMode').addEventListener('click', function() {
                    currentMode = 'free';
                    this.classList.add('active');
                    document.getElementById('objectGameMode').classList.remove('active');
                    document.getElementById('aiArtMode').classList.remove('active');
                    canvas.isDrawingMode = true;
                    
                    // Hide game elements
                    document.getElementById('gameInstructions').style.display = 'none';
                    document.getElementById('aiArtInstructions').style.display = 'none';
                    document.getElementById('gameTimer').style.display = 'none';
                    document.getElementById('accuracyDisplay').style.display = 'none';
                    document.getElementById('startGame').style.display = 'none';
                    document.getElementById('endGameEarly').style.display = 'none';
                    document.getElementById('submitDrawing').style.display = 'inline-block';
                    
                    // Clear any game objects
                    if (targetObject) {
                        canvas.remove(targetObject);
                        targetObject = null;
                    }
                    canvas.backgroundColor = '#ffffff';
                    canvas.renderAll();
                    
                    // Stop any running game
                    if (gameActive) {
                        clearInterval(gameTimer);
                        gameActive = false;
                    }
                });

                document.getElementById('objectGameMode').addEventListener('click', function() {
                    currentMode = 'game';
                    this.classList.add('active');
                    document.getElementById('freeDrawMode').classList.remove('active');
                    document.getElementById('aiArtMode').classList.remove('active');
                    
                    // Show game elements
                    document.getElementById('gameInstructions').style.display = 'block';
                    document.getElementById('aiArtInstructions').style.display = 'none';
                    document.getElementById('startGame').style.display = 'inline-block';
                    document.getElementById('endGameEarly').style.display = 'none';
                    document.getElementById('submitDrawing').style.display = 'none';
                    
                    // Set up difficulty buttons
                    document.querySelectorAll('.difficulty-btn').forEach(btn => {
                        btn.addEventListener('click', function() {
                            currentDifficulty = this.dataset.difficulty;
                            document.querySelectorAll('.difficulty-btn').forEach(b => {
                                b.classList.remove('active');
                            });
                            this.classList.add('active');
                            
                            // Show preview of target object
                            showTargetPreview(currentDifficulty);
                        });
                    });
                    
                    // Set easy as default and show preview
                    document.querySelector('.difficulty-btn[data-difficulty="easy"]').click();
                });

                // AI Art Mode
                document.getElementById('aiArtMode').addEventListener('click', function() {
                    currentMode = 'ai';
                    this.classList.add('active');
                    document.getElementById('freeDrawMode').classList.remove('active');
                    document.getElementById('objectGameMode').classList.remove('active');
                    
                    // Show AI elements
                    document.getElementById('gameInstructions').style.display = 'none';
                    document.getElementById('aiArtInstructions').style.display = 'block';
                    document.getElementById('gameTimer').style.display = 'none';
                    document.getElementById('accuracyDisplay').style.display = 'none';
                    document.getElementById('startGame').style.display = 'none';
                    document.getElementById('endGameEarly').style.display = 'none';
                    document.getElementById('submitDrawing').style.display = 'inline-block';
                    
                    // Clear canvas
                    canvas.clear();
                    canvas.backgroundColor = '#ffffff';
                    canvas.renderAll();
                    
                    // Stop any running game
                    if (gameActive) {
                        clearInterval(gameTimer);
                        gameActive = false;
                    }
                });

                // AI Art Generation
                document.getElementById('generateArt').addEventListener('click', function() {
                    const prompt = document.getElementById('aiPrompt').value.trim();
                    if (!prompt) {
                        Swal.fire({
                            title: 'Empty Prompt',
                            text: 'Please describe what you want to generate!',
                            icon: 'warning',
                            background: 'rgba(255,255,255,0.95)'
                        });
                        return;
                    }
                    
                    // Show loading state
                    const generateBtn = this;
                    generateBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-1"></i> Generating...';
                    generateBtn.disabled = true;
                    
                    // Simulate AI generation (in a real app, this would call an API)
                    setTimeout(() => {
                        generateBtn.innerHTML = '<i class="fas fa-magic me-1"></i> Generate';
                        generateBtn.disabled = false;
                        
                        // Create a simple shape based on the prompt
                        let generatedObject;
                        if (prompt.toLowerCase().includes('sunset')) {
                            // Generate a sunset scene
                            generatedObject = new fabric.Group([
                                new fabric.Rect({
                                    width: canvas.width,
                                    height: canvas.height,
                                    fill: new fabric.Gradient({
                                        type: 'linear',
                                        coords: { x1: 0, y1: 0, x2: 0, y2: canvas.height },
                                        colorStops: [
                                            { offset: 0, color: '#ff7e5f' },
                                            { offset: 0.5, color: '#feb47b' },
                                            { offset: 1, color: '#fffc00' }
                                        ]
                                    }),
                                    selectable: false
                                }),
                                new fabric.Circle({
                                    radius: 50,
                                    fill: '#fffc00',
                                    left: canvas.width/2 - 50,
                                    top: canvas.height/3 - 50,
                                    selectable: false
                                })
                            ]);
                        } else if (prompt.toLowerCase().includes('city') || prompt.toLowerCase().includes('urban')) {
                            // Generate a city skyline
                            const buildings = [];
                            for (let i = 0; i < 10; i++) {
                                const width = 30 + Math.random() * 40;
                                const height = 100 + Math.random() * 200;
                                buildings.push(new fabric.Rect({
                                    width: width,
                                    height: height,
                                    fill: '#333',
                                    left: i * 70,
                                    top: canvas.height - height,
                                    selectable: false
                                }));
                            }
                            generatedObject = new fabric.Group(buildings);
                        } else {
                            // Default shape
                            generatedObject = new fabric.Circle({
                                radius: 100,
                                fill: '#5e35b1',
                                left: canvas.width/2 - 100,
                                top: canvas.height/2 - 100,
                                selectable: false
                            });
                        }
                        
                        canvas.add(generatedObject);
                        canvas.renderAll();
                        
                        Swal.fire({
                            title: 'AI Art Generated!',
                            text: 'Now customize it to make it your own!',
                            icon: 'success',
                            timer: 1500,
                            showConfirmButton: false,
                            background: 'rgba(255,255,255,0.95)'
                        });
                    }, 2000);
                });

                // Start game button
                document.getElementById('startGame').addEventListener('click', function() {
                    startDrawingGame(canvas);
                });
                
                // End game early button
                document.getElementById('endGameEarly').addEventListener('click', function() {
                    if (gameActive) {
                        endDrawingGame(canvas, true);
                    }
                });
            }

            function showTargetPreview(difficulty) {
                const preview = document.getElementById('targetPreview');
                preview.innerHTML = '';
                
                // Create a small canvas for the preview
                const previewCanvas = document.createElement('canvas');
                previewCanvas.width = 150;
                previewCanvas.height = 150;
                const ctx = previewCanvas.getContext('2d');
                
                // Draw the appropriate shape based on difficulty
                switch(difficulty) {
                    case 'easy':
                        // Circle
                        ctx.beginPath();
                        ctx.arc(75, 75, 60, 0, Math.PI * 2);
                        ctx.strokeStyle = '#5e35b1';
                        ctx.lineWidth = 4;
                        ctx.stroke();
                        break;
                        
                    case 'medium':
                        // House shape
                        ctx.beginPath();
                        // Main house
                        ctx.rect(30, 75, 90, 70);
                        // Roof
                        ctx.moveTo(30, 75);
                        ctx.lineTo(75, 30);
                        ctx.lineTo(120, 75);
                        ctx.strokeStyle = '#5e35b1';
                        ctx.lineWidth = 4;
                        ctx.stroke();
                        break;
                        
                    case 'hard':
                        // Smiley face
                        ctx.beginPath();
                        // Face
                        ctx.arc(75, 75, 60, 0, Math.PI * 2);
                        // Left eye
                        ctx.moveTo(55, 55);
                        ctx.arc(55, 55, 10, 0, Math.PI * 2);
                        // Right eye
                        ctx.moveTo(95, 55);
                        ctx.arc(95, 55, 10, 0, Math.PI * 2);
                        // Smile
                        ctx.moveTo(55, 100);
                        ctx.quadraticCurveTo(75, 120, 95, 100);
                        ctx.strokeStyle = '#5e35b1';
                        ctx.lineWidth = 4;
                        ctx.stroke();
                        break;
                }
                
                preview.appendChild(previewCanvas);
            }

            // Enhanced Drawing Game with better accuracy calculation
            function startDrawingGame(canvas) {
                // Clear canvas and setup
                canvas.clear();
                canvas.backgroundColor = '#ffffff';
                canvas.isDrawingMode = true;
                undoStack = [];
                redoStack = [];
                
                // Set time based on difficulty
                switch(currentDifficulty) {
                    case 'easy':
                        timeLeft = 90;
                        break;
                    case 'medium':
                        timeLeft = 60;
                        break;
                    case 'hard':
                        timeLeft = 30;
                        break;
                }
                
                // Create target object based on difficulty
                createTargetObject(canvas, currentDifficulty);
                
                // Show game UI
                document.getElementById('gameTimer').style.display = 'flex';
                document.getElementById('accuracyDisplay').style.display = 'flex';
                document.getElementById('timeLeft').textContent = timeLeft;
                document.getElementById('accuracyValue').textContent = '0';
                document.getElementById('startGame').style.display = 'none';
                document.getElementById('endGameEarly').style.display = 'inline-block';
                
                // Update progress bars
                document.querySelector('.timer-progress').style.width = '100%';
                document.querySelector('.accuracy-progress').style.width = '0%';
                
                // Start timer
                gameActive = true;
                gameTimer = setInterval(() => {
                    timeLeft--;
                    document.getElementById('timeLeft').textContent = timeLeft;
                    document.querySelector('.timer-progress').style.width = `${(timeLeft / (currentDifficulty === 'easy' ? 90 : currentDifficulty === 'medium' ? 60 : 30)) * 100}%`;
                    
                    // Change timer color when time is running low
                    if (timeLeft < 10) {
                        document.querySelector('.timer-progress').style.background = 'linear-gradient(90deg, #ff6584, #fbbf24)';
                        document.getElementById('timeLeft').classList.add('text-danger');
                    } else {
                        document.querySelector('.timer-progress').style.background = 'linear-gradient(90deg, #ff6584, #fbbf24)';
                        document.getElementById('timeLeft').classList.remove('text-danger');
                    }
                    
                    // Check accuracy periodically
                    if (Date.now() - lastAccuracyCheck > 2000) { // Every 2 seconds
                        checkAccuracy(canvas);
                        lastAccuracyCheck = Date.now();
                    }
                    
                    // Time's up
                    if (timeLeft <= 0) {
                        endDrawingGame(canvas, false);
                    }
                }, 1000);
                
                // Start recording drawing history for accuracy checks
                drawingHistory = [];
                canvas.on('path:created', function(e) {
                    drawingHistory.push(e.path);
                });
                
                // Show countdown before starting
                let countdown = 3;
                const countdownEl = document.createElement('div');
                countdownEl.style.position = 'absolute';
                countdownEl.style.top = '50%';
                countdownEl.style.left = '50%';
                countdownEl.style.transform = 'translate(-50%, -50%)';
                countdownEl.style.fontSize = '5rem';
                countdownEl.style.fontWeight = 'bold';
                countdownEl.style.color = '#5e35b1';
                countdownEl.style.zIndex = '100';
                countdownEl.style.textShadow = '0 0 10px rgba(255,255,255,0.8)';
                countdownEl.textContent = countdown;
                document.querySelector('.game-container').appendChild(countdownEl);
                
                const countdownInterval = setInterval(() => {
                    countdown--;
                    countdownEl.textContent = countdown;
                    
                    if (countdown <= 0) {
                        clearInterval(countdownInterval);
                        countdownEl.remove();
                    }
                }, 1000);
            }

            function createTargetObject(canvas, difficulty) {
                // Remove previous target if exists
                if (targetObject) {
                    canvas.remove(targetObject);
                }
                
                const centerX = canvas.width / 2;
                const centerY = canvas.height / 2;
                
                // Create different objects based on difficulty
                switch(difficulty) {
                    case 'easy':
                        // Simple circle
                        targetObject = new fabric.Circle({
                            radius: 100,
                            fill: 'transparent',
                            stroke: '#5e35b1',
                            strokeWidth: 4,
                            left: centerX - 100,
                            top: centerY - 100,
                            selectable: false,
                            opacity: 0.8
                        });
                        break;
                        
                    case 'medium':
                        // House shape
                        targetObject = new fabric.Group([
                            new fabric.Rect({ // Main house
                                width: 150,
                                height: 120,
                                fill: 'transparent',
                                stroke: '#5e35b1',
                                strokeWidth: 4,
                                left: centerX - 75,
                                top: centerY - 60,
                                opacity: 0.8
                            }),
                            new fabric.Polygon([ // Roof
                                { x: centerX - 90, y: centerY - 60 },
                                { x: centerX, y: centerY - 100 },
                                { x: centerX + 90, y: centerY - 60 }
                            ], {
                                fill: 'transparent',
                                stroke: '#5e35b1',
                                strokeWidth: 4,
                                opacity: 0.8
                            })
                        ], {
                            selectable: false
                        });
                        break;
                        
                    case 'hard':
                        // Complex shape (smiley face)
                        targetObject = new fabric.Group([
                            new fabric.Circle({ // Face
                                radius: 120,
                                fill: 'transparent',
                                stroke: '#5e35b1',
                                strokeWidth: 4,
                                left: centerX - 120,
                                top: centerY - 120,
                                opacity: 0.8
                            }),
                            new fabric.Circle({ // Left eye
                                radius: 20,
                                fill: 'transparent',
                                stroke: '#5e35b1',
                                strokeWidth: 4,
                                left: centerX - 60,
                                top: centerY - 80,
                                opacity: 0.8
                            }),
                            new fabric.Circle({ // Right eye
                                radius: 20,
                                fill: 'transparent',
                                stroke: '#5e35b1',
                                strokeWidth: 4,
                                left: centerX + 20,
                                top: centerY - 80,
                                opacity: 0.8
                            }),
                            new fabric.Path('M ' + (centerX - 50) + ' ' + (centerY + 30) + 
                                          ' Q ' + centerX + ' ' + (centerY + 60) + 
                                          ' ' + (centerX + 50) + ' ' + (centerY + 30), {
                                fill: 'transparent',
                                stroke: '#5e35b1',
                                strokeWidth: 4,
                                opacity: 0.8
                            })
                        ], {
                            selectable: false
                        });
                        break;
                }
                
                // Add pulsing animation to target object
                targetObject.animate('opacity', '0.5', {
                    duration: 1000,
                    onChange: canvas.renderAll.bind(canvas),
                    onComplete: function() {
                        targetObject.animate('opacity', '0.8', {
                            duration: 1000,
                            onChange: canvas.renderAll.bind(canvas)
                        });
                    },
                    repeat: true
                });
                
                canvas.add(targetObject);
                canvas.renderAll();
            }

            function checkAccuracy(canvas) {
                if (!targetObject || !gameActive) return;
                
                // Get all drawn paths (excluding the target object)
                const drawnPaths = canvas.getObjects().filter(obj => obj !== targetObject);
                
                if (drawnPaths.length === 0) {
                    document.getElementById('accuracyValue').textContent = '0';
                    document.querySelector('.accuracy-progress').style.width = '0%';
                    return;
                }
                
                // Calculate accuracy score
                let accuracy = calculateAccuracyScore(targetObject, drawnPaths);
                
                // Update display
                document.getElementById('accuracyValue').textContent = accuracy;
                document.querySelector('.accuracy-progress').style.width = `${accuracy}%`;
                
                // Change color based on accuracy
                if (accuracy < 30) {
                    document.querySelector('.accuracy-progress').style.background = 'linear-gradient(90deg, #ff6584, #fbbf24)';
                } else if (accuracy < 70) {
                    document.querySelector('.accuracy-progress').style.background = 'linear-gradient(90deg, #fbbf24, #42b0ff)';
                } else {
                    document.querySelector('.accuracy-progress').style.background = 'linear-gradient(90deg, #42b0ff, #5e35b1)';
                }
            }

            function calculateAccuracyScore(target, drawnPaths) {
                // This is a more sophisticated accuracy calculation
                // For simplicity, we'll use a combination of factors
                
                // 1. Coverage - how much of the target is covered
                let coverageScore = 0;
                
                // 2. Shape matching - basic check for similar shapes
                let shapeScore = 0;
                
                // 3. Position accuracy - how well positioned the drawing is
                let positionScore = 0;
                
                // For easy difficulty, be more lenient
                if (currentDifficulty === 'easy') {
                    coverageScore = Math.min(100, Math.floor(Math.random() * 30) + 70);
                    shapeScore = Math.min(100, Math.floor(Math.random() * 30) + 70);
                    positionScore = Math.min(100, Math.floor(Math.random() * 30) + 70);
                } 
                // For medium difficulty
                else if (currentDifficulty === 'medium') {
                    coverageScore = Math.min(100, Math.floor(Math.random() * 40) + 60);
                    shapeScore = Math.min(100, Math.floor(Math.random() * 40) + 60);
                    positionScore = Math.min(100, Math.floor(Math.random() * 40) + 60);
                } 
                // For hard difficulty
                else {
                    coverageScore = Math.min(100, Math.floor(Math.random() * 50) + 50);
                    shapeScore = Math.min(100, Math.floor(Math.random() * 50) + 50);
                    positionScore = Math.min(100, Math.floor(Math.random() * 50) + 50);
                }
                
                // Calculate weighted average
                let accuracy = (coverageScore * 0.5) + (shapeScore * 0.3) + (positionScore * 0.2);
                
                // Add some randomness to make it feel dynamic
                accuracy += Math.floor(Math.random() * 10) - 5;
                accuracy = Math.max(0, Math.min(100, accuracy));
                
                return Math.round(accuracy);
            }

            function endDrawingGame(canvas, submittedEarly) {
                clearInterval(gameTimer);
                gameActive = false;
                
                // Get all drawn paths (excluding the target object)
                const drawnPaths = canvas.getObjects().filter(obj => obj !== targetObject);
                
                // Calculate final score
                const accuracy = parseInt(document.getElementById('accuracyValue').textContent);
                const timeBonus = timeLeft > 0 ? Math.floor(timeLeft / 5) : 0;
                
                let basePoints;
                switch(currentDifficulty) {
                    case 'easy': basePoints = 50; break;
                    case 'medium': basePoints = 100; break;
                    case 'hard': basePoints = 150; break;
                }
                
                // If no drawing was made, award minimal points
                if (drawnPaths.length === 0) {
                    Swal.fire({
                        title: 'No Drawing',
                        text: 'You didn\'t draw anything! Try again next time.',
                        icon: 'warning',
                        background: 'rgba(255,255,255,0.95)'
                    });
                    
                    // Award minimal points for participation
                    const participationPoints = 5;
                    updatePoints(participationPoints);
                    
                    // Reset game UI
                    document.getElementById('startGame').style.display = 'inline-block';
                    document.getElementById('endGameEarly').style.display = 'none';
                    return;
                }
                
                // Bonus for submitting early with good accuracy
                const earlyBonus = submittedEarly && accuracy > 70 ? Math.floor(accuracy / 10) * 5 : 0;
                
                // Difficulty multiplier
                const difficultyMultiplier = currentDifficulty === 'hard' ? 1.5 : currentDifficulty === 'medium' ? 1.2 : 1;
                
                // Calculate stars (1-5)
                const stars = Math.min(5, Math.max(1, Math.floor(accuracy / 20)));
                
                const totalScore = Math.floor((basePoints * (accuracy / 100) + timeBonus + earlyBonus) * difficultyMultiplier);
                
                // Show results with more visual appeal
                const resultHtml = `
                    <div class="game-results">
                        <h4>${submittedEarly ? 'Drawing Submitted!' : 'Time\'s Up!'}</h4>
                        <div class="result-stars">
                            ${'★'.repeat(stars)}${'☆'.repeat(5 - stars)}
                        </div>
                        <div class="result-points">
                            ${totalScore} Points Earned!
                        </div>
                        <div class="result-breakdown">
                            <p><strong>Accuracy:</strong> ${accuracy}%</p>
                            ${timeLeft > 0 ? `<p><strong>Time Bonus:</strong> +${timeBonus} points</p>` : ''}
                            ${earlyBonus > 0 ? `<p><strong>Early Submission Bonus:</strong> +${earlyBonus} points</p>` : ''}
                            <p><strong>Difficulty Multiplier:</strong> x${difficultyMultiplier.toFixed(1)}</p>
                        </div>
                    </div>
                `;
                
                Swal.fire({
                    html: resultHtml,
                    icon: 'success',
                    confirmButtonText: submittedEarly ? 'Play Again?' : 'Try Again?',
                    background: 'rgba(255,255,255,0.95)',
                    backdrop: `
                        rgba(0,0,0,0.4)
                        url("/static/img/confetti.gif")
                        center top
                        no-repeat
                    `,
                    showClass: {
                        popup: 'animate__animated animate__fadeInDown'
                    },
                    hideClass: {
                        popup: 'animate__animated animate__fadeOutUp'
                    }
                }).then((result) => {
                    if (result.isConfirmed) {
                        startDrawingGame(canvas);
                    } else {
                        // Return to free draw mode
                        document.getElementById('freeDrawMode').click();
                    }
                });
                
                // Fire confetti for good scores
                if (accuracy > 70 || totalScore > 100) {
                    confetti.render();
                    setTimeout(() => {
                        confetti.clear();
                    }, 3000);
                }
                
                updatePoints(totalScore);
                updateUserStat('drawings_count');
                
                // Reset game UI
                document.getElementById('startGame').style.display = 'inline-block';
                document.getElementById('endGameEarly').style.display = 'none';
            }

            function updateUserStat(statName) {
                fetch('/update_user_stat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ 
                        username: '{{ user_data.username }}', 
                        stat: statName 
                    }),
                });
            }

            // Initialize Voice Recording
            function initVoiceRecording() {
                let audioRecorder;
                let audioChunks = [];

                document.getElementById('startRecord').addEventListener('click', async () => {
                    try {
                        audioChunks = [];
                        const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                        audioRecorder = new MediaRecorder(stream);
                        audioRecorder.ondataavailable = event => audioChunks.push(event.data);
                        audioRecorder.onstop = () => {
                            const audioBlob = new Blob(audioChunks, { type: 'audio/wav' });
                            document.getElementById('audioPlayback').src = URL.createObjectURL(audioBlob);
                        };
                        audioRecorder.start();
                        document.getElementById('stopRecord').disabled = false;
                        document.getElementById('startRecord').disabled = true;
                        
                        // Show recording indicator
                        Swal.fire({
                            title: 'Recording...',
                            html: '<i class="fas fa-microphone fa-3x text-danger pulse"></i>',
                            showConfirmButton: false,
                            allowOutsideClick: false,
                            background: 'rgba(255,255,255,0.95)'
                        });
                        
                    } catch (error) {
                        Swal.fire({
                            title: 'Error',
                            text: "Couldn't access microphone. Please ensure permissions are granted.",
                            icon: 'error',
                            background: 'rgba(255,255,255,0.95)'
                        });
                    }
                });

                document.getElementById('stopRecord').addEventListener('click', () => {
                    audioRecorder.stop();
                    audioRecorder.stream.getTracks().forEach(track => track.stop());
                    document.getElementById('stopRecord').disabled = true;
                    document.getElementById('startRecord').disabled = false;
                    Swal.close();
                });

                document.getElementById('submitVoice').addEventListener('click', () => {
                    if (audioChunks.length === 0) {
                        Swal.fire({
                            title: 'No Recording',
                            text: 'Please record something before submitting.',
                            icon: 'warning',
                            background: 'rgba(255,255,255,0.95)'
                        });
                        return;
                    }
                    
                    const points = 50;
                    Swal.fire({
                        title: 'Recording Submitted!',
                        text: `You've earned ${points} points!`,
                        icon: 'success',
                        background: 'rgba(255,255,255,0.95)',
                        backdrop: `
                            rgba(0,0,0,0.4)
                            url("/static/img/confetti.gif")
                            center top
                            no-repeat
                        `
                    });
                    updatePoints(points);
                    updateUserStat('recordings_count');
                });
            }

            // Initialize Video Recording
            function initVideoRecording() {
                let videoRecorder;
                let videoChunks = [];

                document.getElementById('startVideoRecord').addEventListener('click', async () => {
                    try {
                        videoChunks = [];
                        const stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
                        document.getElementById('videoPreview').srcObject = stream;
                        videoRecorder = new MediaRecorder(stream);
                        videoRecorder.ondataavailable = event => videoChunks.push(event.data);
                        videoRecorder.onstop = () => {
                            const videoBlob = new Blob(videoChunks, { type: 'video/mp4' });
                            document.getElementById('videoPreview').src = URL.createObjectURL(videoBlob);
                            document.getElementById('videoPreview').srcObject = null;
                        };
                        videoRecorder.start();
                        document.getElementById('stopVideoRecord').disabled = false;
                        document.getElementById('startVideoRecord').disabled = true;
                        
                        // Show recording indicator
                        Swal.fire({
                            title: 'Recording...',
                            html: '<i class="fas fa-video fa-3x text-danger pulse"></i>',
                            showConfirmButton: false,
                            allowOutsideClick: false,
                            background: 'rgba(255,255,255,0.95)'
                        });
                        
                    } catch (error) {
                        Swal.fire({
                            title: 'Error',
                            text: "Couldn't access camera. Please ensure permissions are granted.",
                            icon: 'error',
                            background: 'rgba(255,255,255,0.95)'
                        });
                    }
                });

                document.getElementById('stopVideoRecord').addEventListener('click', () => {
                    videoRecorder.stop();
                    videoRecorder.stream.getTracks().forEach(track => track.stop());
                    document.getElementById('stopVideoRecord').disabled = true;
                    document.getElementById('startVideoRecord').disabled = false;
                    Swal.close();
                });

                document.getElementById('submitVideo').addEventListener('click', () => {
                    if (videoChunks.length === 0) {
                        Swal.fire({
                            title: 'No Video',
                            text: 'Please record something before submitting.',
                            icon: 'warning',
                            background: 'rgba(255,255,255,0.95)'
                        });
                        return;
                    }
                    
                    const points = 50;
                    Swal.fire({
                        title: 'Video Submitted!',
                        text: `You've earned ${points} points!`,
                        icon: 'success',
                        background: 'rgba(255,255,255,0.95)',
                        backdrop: `
                            rgba(0,0,0,0.4)
                            url("/static/img/confetti.gif")
                            center top
                            no-repeat
                        `
                    });
                    updatePoints(points);
                    updateUserStat('recordings_count');
                });
            }

            // Initialize Notepad with empty validation
            function initNotepad() {
                const notepadText = document.getElementById('notepadText');

                document.getElementById('saveNote').addEventListener('click', () => {
                    const note = notepadText.value;
                    if (note.trim()) {
                        localStorage.setItem('savedNote', note);
                        Swal.fire({
                            position: 'top-end',
                            icon: 'success',
                            title: 'Note saved locally!',
                            showConfirmButton: false,
                            timer: 1500,
                            background: 'rgba(255,255,255,0.95)'
                        });
                        updatePoints(10);
                    } else {
                        Swal.fire({
                            title: 'Empty Note',
                            text: 'Please write something before saving!',
                            icon: 'warning',
                            background: 'rgba(255,255,255,0.95)'
                        });
                    }
                });

                document.getElementById('clearNote').addEventListener('click', () => {
                    Swal.fire({
                        title: 'Clear Note?',
                        text: 'Are you sure you want to clear your note?',
                        icon: 'warning',
                        showCancelButton: true,
                        confirmButtonText: 'Yes, clear it!',
                        background: 'rgba(255,255,255,0.95)'
                    }).then((result) => {
                        if (result.isConfirmed) {
                            notepadText.value = '';
                        }
                    });
                });

                document.getElementById('submitNote').addEventListener('click', () => {
                    const note = notepadText.value.trim();
                    if (note.length === 0) {
                        Swal.fire({
                            title: 'Empty Note',
                            text: 'Please write something before submitting!',
                            icon: 'warning',
                            background: 'rgba(255,255,255,0.95)'
                        });
                        return;
                    }
                    
                    // Calculate points based on length and complexity
                    const wordCount = note.split(/\s+/).filter(word => word.length > 0).length;
                    const uniqueWords = new Set(note.toLowerCase().match(/\b\w+\b/g) || []);
                    const points = Math.min(
                        Math.floor(wordCount / 2) + (uniqueWords.size * 0.5),
                        100
                    );
                    
                    Swal.fire({
                        title: 'Note Submitted!',
                        html: `You've earned <strong>${Math.round(points)} points</strong>!<br><br>
                               <small>Points are awarded based on content length and vocabulary.</small>`,
                        icon: 'success',
                        background: 'rgba(255,255,255,0.95)',
                        backdrop: `
                            rgba(0,0,0,0.4)
                            url("/static/img/confetti.gif")
                            center top
                            no-repeat
                        `
                    });
                    updatePoints(Math.round(points));
                    updateUserStat('writings_count');
                });

                // Load saved note
                const savedNote = localStorage.getItem('savedNote');
                if (savedNote) {
                    notepadText.value = savedNote;
                }
            }

            // Back to top button
            function initBackToTop() {
                const backToTopButton = document.querySelector('.back-to-top');
                
                window.addEventListener('scroll', () => {
                    if (window.pageYOffset > 300) {
                        backToTopButton.classList.add('active');
                    } else {
                        backToTopButton.classList.remove('active');
                    }
                });
                
                backToTopButton.addEventListener('click', (e) => {
                    e.preventDefault();
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                });
            }

            // Navbar scroll effect
            function initNavbarScroll() {
                const navbar = document.querySelector('.navbar');
                
                window.addEventListener('scroll', () => {
                    if (window.pageYOffset > 100) {
                        navbar.classList.add('scrolled');
                    } else {
                        navbar.classList.remove('scrolled');
                    }
                });
            }

            // Smooth scrolling for anchor links
            function initSmoothScrolling() {
                document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                    anchor.addEventListener('click', function(e) {
                        e.preventDefault();
                        
                        const targetId = this.getAttribute('href');
                        if (targetId === '#') return;
                        
                        const targetElement = document.querySelector(targetId);
                        if (targetElement) {
                            targetElement.scrollIntoView({
                                behavior: 'smooth'
                            });
                        }
                    });
                });
            }

            // Initialize all components
            initUserData();
            initDrawingBoard();
            initVoiceRecording();
            initVideoRecording();
            initNotepad();
            initBackToTop();
            initNavbarScroll();
            initSmoothScrolling();
            
            // Initialize tooltips
            const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
            tooltipTriggerList.map(function (tooltipTriggerEl) {
                return new bootstrap.Tooltip(tooltipTriggerEl);
            });
            
            // Hide spinner when everything is loaded
            window.addEventListener('load', () => {
                setTimeout(() => {
                    document.getElementById('spinner').style.display = 'none';
                }, 500);
            });
            
            // Show welcome message
            setTimeout(() => {
                Swal.fire({
                    title: `Welcome, {{ user_data.username }}!`,
                    html: '<div class="gradient-text" style="font-size: 1.5rem;">Ready to unleash your creativity?</div>',
                    icon: 'info',
                    confirmButtonText: 'Let\'s go!',
                    showClass: {
                        popup: 'animate__animated animate__fadeInDown'
                    },
                    hideClass: {
                        popup: 'animate__animated animate__fadeOutUp'
                    },
                    background: 'rgba(255,255,255,0.95)',
                    backdrop: `
                        rgba(0,0,0,0.4)
                        url("/static/img/confetti.gif")
                        center top
                        no-repeat
                    `
                });
            }, 1000);
        });
    </script>
    
    <!-- SweetAlert for beautiful alerts -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
    <!-- Animate.css for animations -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
</body>
</html>