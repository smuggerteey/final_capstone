<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat with Our AI Assistant ðŸ¤–</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='chat.css') }}">
</head>
<body>

    <!-- Main Container -->
    <div class="chat-container">
        
        <!-- Header Section -->
        <header class="chat-header">
            <h1>Chat with Our AI Assistant ðŸ¤–</h1>
            <p>Ask any questions, and our AI assistant will assist you with quick responses.</p>
        </header>

        <!-- Chatbox Section -->
        <main class="chatbox" id="chatbox" aria-live="polite">
            <!-- User and bot messages will be dynamically added here -->
        </main>

        <!-- Message Input Section -->
        <div class="message-area">
            <input type="text" id="inputMessage" class="message-input" placeholder="Type your message..." aria-label="Chat input">
            <button id="sendBtn" class="btn">Send</button>
        </div>

        <!-- Navigation Button -->
        <div class="back-btn">
            <a href="{{ url_for('admindashboard') if username in ['smuggerteey', 'cicada403'] else ('dashboard' if user_data['role'] == 'Artist' else 'userdashboard') }}" class="btn">
                Back to Dashboard
            </a>
        </div>

        <!-- Footer Section -->
        <footer class="chat-footer">
            &copy; 2024 Digital Art & Creative Hub. All rights reserved. ðŸ˜Š
        </footer>

    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function() {
            const sendBtn = document.getElementById("sendBtn");
            const inputMessage = document.getElementById("inputMessage");
            const chatbox = document.getElementById("chatbox");

            // Function to append messages
            function appendMessage(sender, message, className) {
                const newMessage = document.createElement("div");
                newMessage.classList.add(className);
                newMessage.innerHTML = `<strong>${sender}:</strong> ${message}`;
                chatbox.appendChild(newMessage);
                chatbox.scrollTop = chatbox.scrollHeight; // Auto-scroll to the latest message
            }

            // Send message function
            function sendMessage() {
                const messageText = inputMessage.value.trim();
                if (messageText === "") return; // Prevent sending empty messages

                appendMessage("You", messageText, "user-message");
                inputMessage.value = ""; // Clear input field

                // Send message to the backend
                fetch("/predict", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ input_text: messageText })
                })
                .then(response => response.json())
                .then(data => {
                    const reply = data.response || "Sorry, something went wrong. Please try again.";
                    appendMessage("AI", reply, "bot-message");
                })
                .catch(error => {
                    appendMessage("AI", "Error: " + error.message, "bot-message");
                });
            }

            // Event listeners
            sendBtn.addEventListener("click", sendMessage);
            inputMessage.addEventListener("keypress", function(event) {
                if (event.key === "Enter") sendMessage();
            });
        });
    </script>

</body>
</html>
